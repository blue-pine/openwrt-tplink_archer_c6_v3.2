<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" manifest="app.1657161073674.manifest">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<link rel="shortcut icon" href="logo/favicon.1657161073674.ico"/>
<!-- <link rel="icon" type="img/vnd.microsoft.icon" href="logo/favicon.1657161073674.ico"/> -->

<!-- <link type="text/css" href="css/reset.css" rel="stylesheet" /> -->
<link type="text/css" href="css/widget.1657161073674.css" rel="stylesheet" />

<link type="text/css" href="themes/green/css/style.1657161073674.css" rel="stylesheet" />

<!--[if lte IE 8]>
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<link href="themes/green/css/ie.1657161073674.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if lte IE 7]>
<link href="themes/green/css/ie.1657161073674.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if lte IE 6]>
<link href="themes/green/css/ie.1657161073674.css" rel="stylesheet" type="text/css" />
<![endif]-->

<title>Opening...</title>

</head>

<body>

<noscript>
    <meta http-equiv="refresh" content="0; url=error.1657161073674.html"/>
</noscript>

<!--主界面-->
<iframe src="./cache.1657161073674.html" frameborder="0" scrolling="auto" style="display:none" ></iframe>
<div class="top" id="top-wrapper">
    <div class="top-bg">
        <div class="top-bg-l"></div>
        <!-- <div class="top-bg-r"></div> -->
    </div><!-- background -->
    <div class="top-header">
		<div class="top-header-wrap">
        	<h1 id="product-tag"></h1>
            <div class="top-nav" id="top-nav">
                <!-- 菜单需要考虑的问题：1、动态加载；2、字符由charset控制 -->
                <ul id="ul-nav">
                    <li class="fst">
						<div class="nav-wrap">
							<a class="nav" name="quick_setup" href="pages/frame/quick-setup.1657161073674.html">
                        <span></span>
							</a>
						</div>
					</li>
					<li>
						<div class="nav-wrap">
							<a class="nav" name="basic" href="pages/frame/basic.1657161073674.html">
                        <span></span>
							</a>
						</div>
					</li>
					<li>
						<div class="nav-wrap">
							<a class="nav" name="advanced" href="pages/frame/advanced.1657161073674.html">
                        <span></span>
							</a>
						</div>
					</li>
                </ul><!-- <li class="separator"></li> -->
            </div><!-- top-nav -->
            
            <div id="top-control" class="top-control">
            	<!--<div id="lan-select" class="lan-select-container">
                    <select id="lan-select">
                        <option>English</option>
                        <option>中文</option>
                    </select>--><!-- lan-select -->
                <!--</div>-->
                <div class="lan-select-container">
                    <input id="lan-select" />
                </div>
                
                <a class="top-control-btn hidden" id="top-control-led" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-led" class="text"></span>
                </a>
                <a class="top-control-btn hidden" id="top-control-sysmode" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-sysmode" class="text"></span>
                </a>
                <a class="top-control-btn" id="top-control-logout" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-logout" class="text"></span>
                </a>
                <a class="top-control-btn" id="top-control-reboot" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-reboot" class="text"></span>
                </a>
                <a class="top-control-btn" style="display:none" id="top-control-update" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="upgrade-hint"></span>
                    <span id="txt-update" class="text"></span>
                </a>
            </div>
        </div>
    </div><!-- top-header -->

    <!-- LED 状态提示 -->
    <div id="led-promote-form-container">
        <div id="led-prompt-form">
        </div>
    </div>
	
	<div class="index-update-alert-cnt hidden">
		<div class="close-layer"></div>
		<span id="index-update-alert"></span>
	</div>

    <div class="top-main">
        <div class="top-main-wrap">
            <div class="top-content">
                <div class="top-content-wrap" id="top-content">
                </div>
            </div><!-- top-content -->
            
            
            <div class="top-footer hidden">
                <div class="top-footer-wrap">
                    <span id="product-info">
                        <span id="firmware-version-title"></span>
                        <span id="firmware-version-content"></span>
                        <span id="hardware-version-title"></span>
                        <span id="hardware-version-content"></span>
                    </span>
                            
                    <span class="help-faq">
                        <a id="btn-faq" class="btn-faq" href="http://www.tp-link.com/support/" target="_blank"></a>
                    </span>

                    <div class="clear"></div>
                </div>
            </div><!-- top-footer -->
        </div>
		<div class="top-main-img"></div>
    </div>

</div><!-- top-wrapper -->

<!--遮蔽层-->
<div id="mask" class="mask"></div>
<!--loading-->
<div class="loading-container" id="loading-container">
    <div class="loading-container-wrap">
        <div class="loading-container-inner">
            <div class="loading-waiting-icon"></div>
        </div>
    </div>
</div>

<!-- 重启和登出的确认 -->
<div id="reboot_confirm_msg" class="hidden warning">
    <div id="reboot_confirm_qa">
        <h4 class="title">
            <span class="icon"></span>
            <span class="text" id="reboot-confirm-msg-text"></span>
        </h4>
    </div>

    <div id="loading_msg" class="reboot-loading-msg hidden">
        <p id="reboot_progressbar_text" class="reboot-progressbar-text"></p>
        <input id="reboot_loading_progressbar" />
    </div>
</div>
<!-- /////////////////////////////////////////////////////////////// -->
<div id="mode_choose_msg" class="hidden">
    <div class="reboot-confirm-qa">
        <h4 class="title">
            <span class="icon"></span>
            <span id="mode_choose_text" class="text mode-switch-text"></span>
        </h4>

        <div id="mode_reboot_content">
            <input id="mode_choose_input" name="mode" type="text" class=""/>
            <p id="ap_tips" class="mode-slt-p"></p>
            <p id="router_tips" class="mode-slt-p"></p>
            <p id="repeater_tips" class="mode-slt-p"></p>
        </div>
    </div>
</div>

<div id="mode_reboot_msg">
    <div id="mode_reboot_note_content">
        <p id="mode_reboot_note"></p>
    </div>
</div>

<div id="mode_fail_msg" class="warning hidden">
    <div id="mode_change_fail" class="">
        <h4 class="title">
            <span class="icon"></span>
            <span id="mode_fail_title" class="text"></span>
        </h4>
    </div>    
</div>

<div id="logout_confirm_msg" class="hidden warning">
    <div class="reboot-confirm-qa">
        <h4 class="title">
            <span class="icon"></span>
            <span class="text" id="logout_confirm_msg_text"></span>
        </h4>
    </div>
</div>

<!-- 提示用户设置登录名和密码 -->
<div id="reset-user-msg-container" class="hidden">
    <div id="reset-user-form">
        <!--<h4 id="reset-user-title" class="title title"></h4>-->
        <div class="reset-user-content">
            <input id="reset-user-new-username" name="new_acc" />
            <input id="reset-user-new-password" name="new_pwd" />
            <input id="reset-user-confirm-password" name="cfm_pwd" />
            <input id="reset-user-confirm-password-status" />
        </div>
        <button type="button" id="btn-reset-user"></button>
    </div>
</div>

<!--全局警告提示框-->
<div id="global-warning-msg" class="hidden warning">
    <h4 class="title">
        <span class="icon"></span>
        <span class="text" id="global-warning-text-perssion-denied"></span>
    </h4>
</div>

<!--
以下是js部分
-->

<!--<script type="text/javascript" src="http://192.168.1.101:1070/target/target-script-min.js#anonymous"></script>-->

<!--  jquery框架加载  -->
<script type="text/javascript" src="js/libs/jquery.min.1657161073674.js"></script>
<script type="text/javascript" src="js/libs/jquery.scrollTo.min.1657161073674.js"></script>
<script type="text/javascript" src="js/libs/jquery.nicescroll.min.1657161073674.js"></script>
<!-- <script type="text/javascript" src="js/libs/jquery.json-2.4.min.1657161073674.js"></script> -->
<!-- <script type="text/javascript" src="js/libs/jquery.extend.js"></script> -->
<!-- <script type="text/javascript" src="js/libs/jquery.cookies.min.js"></script> -->

<!--  语言部分加载  -->

<!-- <script id="lan-js" type="text/javascript" src="locale/en_US/lan.js"></script>
<link id="lan-css" type="text/css" rel="stylesheet" href="locale/en_US/lan.css" /> -->

<script type="text/javascript" src="js/su/locale.js?t=1657161073674"></script>
<script type="text/javascript" src="js/libs/encrypt.1657161073674.js"></script>
<script type="text/javascript" src="js/libs/cryptoJS.min.1657161073674.js"></script>
<script type="text/javascript" src="js/libs/tpEncrypt.1657161073674.js"></script>
<script type="text/javascript">
//<![CDATA[
    try{
        $.su.encryptor = $.encrypt.encryptManager.getEncryptor();
        $.su.locale.URL_LAN_CHECK = $.su.url("/locale?form=index_lang");//"./data/lan.json";
        $.su.locale.get();
    }catch(error){
        location.href = "./error.1657161073674.html";
    };
//]]>
</script>

<!--  引入框架代码， 最后需要统一到一个文件下面  -->
<!--<script type="text/javascript" src="js/su/su.full.min.1657161073674.js"></script>
<script type="text/javascript" src="js/libs/encrypt.1657161073674.js"></script>-->
<script type="text/javascript" src="js/su/su.1657161073674.js"></script>

<script type="text/javascript" src="js/su/data/proxy.1657161073674.js"></script>
<script type="text/javascript" src="js/su/data/store.1657161073674.js"></script>
<script type="text/javascript" src="js/su/data/treestore.1657161073674.js"></script>

<script type="text/javascript" src="js/su/widget/widget.1657161073674.js"></script>

<script type="text/javascript" src="js/su/widget/window/panel.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/window/page.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/window/wizard.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/window/msg.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/window/foldertree.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/window/keyword.1657161073674.js"></script>

<script type="text/javascript" src="js/su/widget/grid/grid.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/grid/editor.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/grid/paging.1657161073674.js"></script>

<script type="text/javascript" src="js/su/widget/form/form.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/fieldset.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/combobox.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/checkbox.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/radio.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/textbox.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/textarea.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/button.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/time.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/file.1657161073674.js"></script>
<!--<script type="text/javascript" src="js/su/widget/form/buttongroup.1657161073674.js"></script>-->
<script type="text/javascript" src="js/su/widget/form/timepicker.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/progressbar.1657161073674.js"></script>
<!--<script type="text/javascript" src="js/su/widget/form/tip.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/region.1657161073674.js"></script>-->
<script type="text/javascript" src="js/su/widget/form/password.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/status.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/slider.1657161073674.js"></script>
<script type="text/javascript" src="js/su/widget/form/switch.1657161073674.js"></script>

<!-- 升级重载后刷新 -->
<script type="text/javascript">
    if(typeof(window.applicationCache) != "undefined")
    {
        var appCache=window.applicationCache;
        appCache.addEventListener('updateready', function(){
            location.reload();
        }, false);
    }
</script>


<!--  运行时代码  -->
<script type="text/javascript">
//<![CDATA[
$(document).ready(function(e){
//获得token
try{
    $.su.url.stok = localStorage.getItem("token") || (function(){
        var stok = "12345",
            href = top.location.href;
        var stokPos = href.indexOf("stok=");
        if (stokPos >= 0){
            stok = href.substring(stokPos+5);
        };
        return stok;
    })();
}catch(e){
    var h = function(){
        location.href = "/";
    };
	
	if (logoutProxy){
		logoutProxy.write({}, h, h, h)
	};
};

//用户登出url
var URL_LED = $.su.url("/admin/ledgeneral?form=setting");
var URL_LOGOUT = $.su.url("/admin/system?form=logout"); //"./data/login.json"
var URL_REBOOT = $.su.url("/admin/system?form=reboot"); //"./data/login.json"
var URL_CHECK_UPGRADE = $.su.url("/admin/cloud_account?form=check_upgrade");
var URL_CHECK_UPGRADE_VERSION = $.su.url("/admin/cloud_account?form=check_cloud_version");
var URL_CHECK_UPGRADE_NOLONG = $.su.url("/admin/cloud_account?form=set_show_flag");
var URL_CHECK_JUMP = $.su.url("/upgrade?form=read");//"./data/check_jump.json";
var URL_CHECK_CLOUD_SUPPORT = $.su.url("/admin/system?form=check_support");

var ledProxy = new $.su.Proxy({
    url: URL_LED,
    autoLoad: false
});

var cloudSupportProxy = new $.su.Proxy({
    url: URL_CHECK_CLOUD_SUPPORT,
    autoLoad: false
});

var logoutProxy = new $.su.Proxy({
    url: URL_LOGOUT,
    autoLoad: false
});

var rebootProxy = new $.su.Proxy({
    url: URL_REBOOT,
    autoLoad: false
});
var checkUpgradeProxy = new $.su.Proxy({
    url: URL_CHECK_UPGRADE,
    autoLoad: false
});
var checkUpgradeVersionProxy = new $.su.Proxy({
    url: URL_CHECK_UPGRADE_VERSION,
    autoLoad: false
});
var checkUpgradeNoShowProxy = new $.su.Proxy({
    url: URL_CHECK_UPGRADE_NOLONG,
    autoLoad: false
});

//var support_url = $.su.CHAR.SUPPORT[$.su.locale.locale.toUpperCase()] || "http://www.tp-link.com/en/Support/";
var support_url = "http://www.tp-link.com/support/";
$("#btn-faq").attr("href",support_url);

$(window).on("resize load", function(){
    var window_height = $(window).height() - 300;
    var window_width = $(window).width();
    $("#led-promote-form-container").css({"width":window_width,"height":window_height,"position":"absolute","z-index":"-999"});
    $("#led-prompt-form").css({"width":window_width,"height":window_height});
});

//index页面初始化
/**********SRT*多语言选择框*SRT*********/
//注意：需要判断是否更改，否则不发送信息~
var lanSelectCombo = $("input#lan-select").combobox({
    cls: "top-lan-select",
    items: [
    ],
    fieldLabel: null
}).on("ev_click", function(e, vOld, vNew){
    //console.log(vOld, vNew)
    if (vOld[0] == vNew[0]){
        return;
    };
    $.su.locale.set(vNew[0], function(){
        lanSelectCombo.combobox("setValue", [$.su.locale.locale]);
    }, function(){
        lanSelectCombo.combobox("setValue", [$.su.locale.locale]);
    });
});

//$("title").text($.su.locale.model);
document.title = $.su.locale.model;
$("h1#product-tag").text($.su.locale.model);

$("span#txt-led").text($.su.CHAR.CONTROL.LED);
$("span#txt-sysmode").html($.su.CHAR.CONTROL.MODE);
$("span#txt-logout").html($.su.CHAR.CONTROL.LOGOUT);
$("span#txt-reboot").html($.su.CHAR.CONTROL.REBOOT);
$("span#txt-update").html($.su.CHAR.CONTROL.UPDATE);

$("span#firmware-version-title").html($.su.CHAR.INDEX.FIRMWARE_VERSION);
$("span#hardware-version-title").html($.su.CHAR.INDEX.HARDWARE_VERSION);
$("a#btn-faq").html($.su.CHAR.INDEX.HELP_SUPPORT);

$('span#mode_fail_title').html($.su.CHAR.INDEX.MODE_FAIL_TIP);

if ($.su.locale.force){
	lanSelectCombo.combobox("hide");
}else{
	var localeProxy = new $.su.Proxy({
		url: $.su.url('/locale?form=index_list')
	});
	localeProxy.read({}, function(data){
		var locale=[];
		for(var i=0;i<data.length;i++){
			locale[i]={};
			locale[i].value=data[i].value;
			locale[i].name=$.su.CHAR.LANGUAGE[data[i].name];
		};
		lanSelectCombo.combobox("loadData",locale).combobox("setValue", [$.su.locale.locale]);
	});
}
/**********END*多语言选择框*END*********/

/**********STR*用户登录信息*STR**********/
var rebootConfirmMsg = $("div#reboot_confirm_msg").msg({
    type: "confirm",
    global: true,
    cls: 'reboot-confirm-size',
    closeBtn: false,
    okHandler: function(e){
        $('div#reboot_confirm_qa').hide();
        $('div#loading_msg').show();
        rebootConfirmMsg.msg('hideButtons');
        
        rebootProxy.write();
        var rebootTime = 60*1000;
        if ($.su.locale.rebootTime > 0){
        	rebootTime = $.su.locale.rebootTime * 1000;
        }
        reboot_pro_bar.progressbar("reset").progressbar('animate',  0, 1, rebootTime, function(){
            if (localStorage){
                localStorage.setItem("token", "");
            };
            location.href = 'http://tplinkwifi.net';
        });
        
        return false;
    },
    cancelHandler: function(){
        rebootConfirmMsg.msg('hide');
    }
});

/*var rebootLoadingMsg = $("div#reboot-loading-msg").msg({
    type: "window",
    global: true
});*/

$('p#ap_tips').html($.su.CHAR.INDEX.ACCESS_POINT_TIPS);
$('p#router_tips').html($.su.CHAR.INDEX.ROUTER_TIPS);
$('p#repeater_tips').html($.su.CHAR.INDEX.REPEATER_TIPS);
$('span#mode_choose_text').html($.su.CHAR.INDEX.MODE_SWITCH);
$('p#mode_reboot_note').html($.su.CHAR.INDEX.MODE_REBOOT_TIP);

var globalProxy = new $.su.Proxy({
    url: $.su.url('/admin/system?form=globalpara')
});

globalProxy.read({}, function(data){
    if(data.usb_support.toUpperCase()=='YES'){
        $.su.suppUsb = true;
    }else{
        $.su.suppUsb = false;
    }

    /*other global paras*/
});

var sysMode = '';

var modeProxy = new $.su.Proxy({
    // url: './data/sysmode.json'
    url: $.su.url('/admin/system?form=sysmode')
});

modeProxy.read({}, function(data){
    sysMode = data.mode;

    if(data.support.toUpperCase()=='YES'){
        $('a#top-control-sysmode').removeClass('hidden');
        $('input#mode_choose_input').radio('setValue', data.mode);
    }else{
        $('a#top-control-sysmode').addClass('hidden');
    }
});

var modeSltMsg = $("div#mode_choose_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "l",
    yesText: $.su.CHAR.OPERATION.SAVE,
    noText: $.su.CHAR.OPERATION.CANCEL,
    okHandler: function(e){
        var modePara = $('input#mode_choose_input').radio('getValue');

		if(sysMode.toUpperCase() != modePara.toUpperCase()){
			modeRebootMsg.msg('show');
		}
    },
	noHandler:function(){
		$('input#mode_choose_input').radio('setValue', sysMode);
	}
});


var modeFailMsg = $("div#mode_fail_msg").msg({
    type: "alert",
    global: true,
    closeBtn: false,
    cls: "l"
});

var modeRebootMsg = $("div#mode_reboot_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "l",
    // yesText: $.su.CHAR.OPERATION.SAVE,
    // noText: $.su.CHAR.OPERATION.CANCEL,
    okHandler: function(e){

        modeProxy.write({mode: $('input#mode_choose_input').radio('getValue')}, function(data){
            $('div#reboot_confirm_qa').hide();
            $('div#loading_msg').show();
            rebootConfirmMsg.msg('hideButtons');
            
            rebootConfirmMsg.msg("show");

            //rebootProxy.write();
            reboot_pro_bar.progressbar("reset").progressbar('animate',  0, 1, 60*1000, function(){
                if (localStorage){
                    localStorage.setItem("token", "");
                };

                //if(data.mode=='router'){
                //    location.href = 'http://tplinkwifi.net';
                //}else{
                //    location.href = 'http://tplinkrepeater.net';
                //}
                location.href = 'http://tplinkwifi.net';
            });            

        }, function(){
            $("div#mode_fail_msg").msg('show');
            // $('div#mode_reboot_note_content').hide();
            $('div#mode_change_fail').show();
        }, function(){
            $("div#mode_fail_msg").msg('show');
            // $('div#mode_reboot_note_content').hide();
            $('div#mode_change_fail').show();
        });
    }
});



$('input#mode_choose_input').radio({
    fieldLabel: null,
    items:[
		{boxlabel: $.su.CHAR.INDEX.ACCESS_POINT, inputValue: 'ap', id:'ap', name:'mode', content:'#ap_tips'},
		{boxlabel: $.su.CHAR.INDEX.ROUTER, inputValue: 'router', id:'router', name:'mode', content:'#router_tips'},
		{boxlabel: $.su.CHAR.INDEX.REPEATER, inputValue: 'repeater', id:'repeater', name:'mode', content:'#repeater_tips'}
    ]
});

var logoutConfirmMsg = $("div#logout_confirm_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "reboot-confirm-size",
    okHandler: function(e){
        var h = function(){
            if (localStorage){
                localStorage.setItem("token", "");
            };
            location.href = "/";
        };
        //localStorage.getItem("token")
        logoutProxy.write({}, h, h);
    }
});

var reboot_pro_bar = $('input#reboot_loading_progressbar').progressbar({
    width: 326,
    height: 6,
    isProgressbar: true,
    cls: 'reboot-loading-probar'
});

$('span#reboot-confirm-msg-text').html($.su.CHAR.INDEX.CONFIRM_REBOOT);
$('p#reboot_progressbar_text').html($.su.CHAR.INDEX.REBOOTING);
$('span#logout_confirm_msg_text').html($.su.CHAR.INDEX.CONFIRM_LOGOUT);

$("div#led-prompt-form").form({
    autoLoad : false
});

var ledpm_support = "";
ledProxy.read({}, function(data){
    ledpm_support = data.ledpm_support;

    if(ledpm_support == "yes"){
        $('a#top-control-led').removeClass('hidden');
        if(data.enable == "on"){
            $("a#top-control-led").removeClass("off");
            $("a#top-control-led").addClass("on");
        }
        else{
            $("a#top-control-led").removeClass("on");
            $("a#top-control-led").addClass("off");
        }
    }else{
        $('a#top-control-led').addClass('hidden');
    }
});

var led_clicked = false;
var tt = false;
$("a#top-control-led").click(function(e){
    if (led_clicked === false)
    {
        led_clicked = true;
        clearTimeout(tt);
        $("#led-promote-form-container").css({"z-index":"1"});
        ledProxy.write({},function(data){
    		if (data.enable === "on") {
        		$("div#led-prompt-form").form("prompt", true, $.su.CHAR.CONTROL.LED_ON);
                $("a#top-control-led").removeClass("off");
                $("a#top-control-led").addClass("on");
            }
			else if(data.enable === "off") {
                $("div#led-prompt-form").form("prompt", true, $.su.CHAR.CONTROL.LED_OFF);
                $("a#top-control-led").removeClass("on");
                $("a#top-control-led").addClass("off");
            }
			else {
                $("div#led-prompt-form").form("prompt", true, $.su.CHAR.CONTROL.LED_DISABLED);
            }

            // if the current page is systemParameters.html,we need to do something.    
            if ($("p#led_night_mode_note").length !== 0){
                if(data.time_set == "yes"){                 
                    if (data.enable == "off"){
                        $("p#led_note").hide();
                        $("p#led_night_mode_note").show(); 
                        $("#led_form").form("disable");
                        $("span#led_time_to").addClass("disabled");
                    } else{
                        $("p#led_note").hide();
                        $("p#led_night_mode_note").hide();  
                        $("#led_form").form("enable");
                        $("span#led_time_to").removeClass("disabled");
                    }
                }
            }

			led_clicked = false;
		},function(data){
			led_clicked = false;
		},function(data){
            led_clicked = false;
        }); 
    }
    
    
    tt = setTimeout(function(){
      $("#led-promote-form-container").css({"z-index":"-999"});
    },3000);
});


$("a#top-control-sysmode").click(function(e){
    modeSltMsg.msg("show");
});

$("a#top-control-logout").click(function(e){
    logoutConfirmMsg.msg("show");
});

$("a#top-control-reboot").click(function(e){
    rebootConfirmMsg.msg("show");
});

$("a#top-control-update").click(function(e){
    $.su.app.jumpPage = "firmware-upgrade";
    $.su.nav.goTo("advanced");
});


/**********END*用户登录信息*END**********/

/**********SRT*警告信息*SRT**********/
$("span#global-warning-text-perssion-denied").html($.su.CHAR.ERROR["00000088"]);
var warningMsg = $("div#global-warning-msg").msg({
    type: "alert",
    global: true,
    cls: "m",
    closeBtn: false
});

/**********END*警告信息*END**********/

/**********SRT*软硬件版本信息*SRT*********/

var firmwareProxy = new $.su.Proxy({
    async: false,
    url: $.su.url("/admin/firmware?form=upgrade")
});

var firstLog = false;

firmwareProxy.read({}, function(data){
    var firmware = $("span#firmware-version-content");
    var hardware = $("span#hardware-version-content");
    if (data){
        if (data.firmware_version){
            firmware.html(data.firmware_version);
        }else{
            firmware.css("display", "none");
        };
        if (data.hardware_version){
            hardware.html(data.hardware_version);
        }else{
            hardware.css("display", "none");
        };

        if (data.is_default == true){
            firstLog = true;
        };

    }else{
        $("span#product-info").css("display", "none");
    };
}, function(){
    $("span#product-info").css("display", "none");
}, function(){
    $("span#product-info").css("display", "none");
});

/**********END*软硬件版本信息*END*********/

/**********STR*app定义*STR*********/
$.su.app = {
    /*runningModule: $({
        name: ""
    }),
    init: function(){
        $.su.app.runningModule.on("ev_unload", function(e, name){
            $.su.app.runningModule[0]["name"] = name;
            //console.log("ev_unload");
            $.su.app.runningModule.off("ev_beforeunload");
        });
    },*/
    runningModule: {
        name: "",
        addUnloadHandler: function(fn){
            if ($.isFunction(fn)){
                this.unloadHandlers.push(fn);
            }
        },
        clearUnloadHandler: function(){
            this.unloadHandlers = [];
        },
         //name: string &   events: string | array
        addWaitingEvents: function(name, events){
            if($.type(events) == "string"){
                events = [events];
            };
            this.waitingEvents[name] = {};
            for(var i = 0; i < events.length; ++i){
                var id = events[i];
                if($.type(id) != "string"){
                    return false;
                }
                this.waitingEvents[name][id] = false;
            }
        },
        clearWaitingEvents: function(){
            this.waitingEvents = {};
        },
        deleteWaitingEvent: function(name){
            if(this.waitingEvents){
                delete(this.waitingEvents[name]);
            }
        },
        fire: function(eventId){
            $.each(this.waitingEvents, function(name, events){
                if(events.hasOwnProperty(eventId)){
                    //点燃事件
                    events[eventId] = true;
                }
                //当前name下的事件全部被点燃，触发name事件
                var allFired = false;
                $.each(events, function(eventId, value){
                    
                    if(!value){
                        allFired = false;
                        return false;
                    }
                    allFired = true;
                });
                if(allFired){
                    $(window).trigger(name);
                }
            });
        },
        unload: function(oldN, newN){
            this.name = newN;
            var handlers = this.unloadHandlers;
            for (var index in handlers){
                var fn = handlers[index];
                if ($.isFunction(fn)){
                    fn();
                }
            };
            this.clearUnloadHandler();
            this.clearWaitingEvents();
        },
        unloadHandlers: []
    },
    errorOperation: {
        denied: function(){
            var msg = $("div#global-warning-msg");
            if (msg.is(":hidden")){
                msg.msg("show");
            }
        },
        userConflict: function(){
            //操作中用户冲突的回调
        }
    },
    navGoTo: function(name, url){
        var contentContainer = $("div#top-content");
        //旧模块卸载
        $.su.Manager.removeLocal();
        $.su.loading.show();

        /*if (name != "quick_setup"){
            //非quicksetup
            
            
            contentContainer.load(url, {}, function(response,status,xhr){
                $.su.layout.doLayout();
                $.su.loading.hide();
            });
        }else{*/
            //$.su.app.runningModule.trigger("ev_beforeunload", [$.su.app.runningModule[0].name, name]);
        var runningModule = $.su.app.runningModule;
            runningModule.unload(runningModule.name, name);

        contentContainer.load(url, {}, function(response,status,xhr){
            //$.su.app.runningModule.trigger("ev_unload", [name]);
            $.su.layout.doLayout();
            //$.su.loading.hide();
            $(".top-footer").show();
            $(".mode_fail_msg").show();
        });

        //}
    },
    menuGoTo: function(name, url, isAdvanced){
        var contentContainer = isAdvanced ? $("div#func-advanced") : $("div#func-basic");
        //旧模块卸载
        $.su.Manager.removeLocal();
        //var runningModule = $.su.app.runningModule;
        //$.su.app.runningModule.trigger("ev_beforeunload", [$.su.app.runningModule[0].name, name]);
        //console.log("menuGoTo", runningModule)
        var runningModule = $.su.app.runningModule;
            runningModule.unload(runningModule.name, name);

        $.su.loading.show();
        contentContainer.addClass("unvisibility");
        contentContainer.load(url, {}, function(response,status,xhr){
            //$.su.app.runningModule.trigger("ev_unload", [name]);
            
            $.su.layout.doLayout();
            /*$("div.top-main").scrollTo({
                top: 0,
                left: 0
            }, 100);*/
            $("div.top-main").scrollTo(0);
            $.su.loading.hide();
            contentContainer.removeClass("unvisibility");
        });
    }   
};
//$.su.app.init();
/**********END*app定义*END*********/

/**********STR*菜单部分效果*STR**********/
$.su.nav = (function(){
	var nav = {};
	//字符串初始化
	var navItems = $("ul#ul-nav li a");
	navItems.each(function(index, element){
		var me = $(element),
			name = me.attr("name");
        me.html("<span>"+$.su.CHAR.NAV[name.toUpperCase()]+"</span>");
    });
	
	navItems.on("click", function(e){
		e.preventDefault();
		var me = $(this),
            name = me.attr("name");
		
		$.su.nav.goTo(name);

	});
	
	nav.goTo = function(name){ 
        var item = $("ul#ul-nav li a[name='"+name+"']");
        var url = item.attr("href");

        $("ul#ul-nav li").removeClass("selected");
        item.closest("li").addClass("selected");
        $.su.app.navGoTo(name, url);
	};

	return nav;
})();

if (firstLog){
    $.su.nav.goTo("quick_setup");

    var resetUserMsg = $("div#reset-user-msg-container").msg({
        type: "window",
        global: true,
        title: $.su.CHAR.QUICK_SETUP.RESET_USER_TITLE_CLOUD,
        cls: "l reset-user"
    });

    //$("h4#reset-user-title").html($.su.CHAR.QUICK_SETUP.RESET_USER_TITLE_CLOUD);
	var checkFocusTargetFunction = function(e){
		e = e ? e : window.event;
		if( ($.su.func.getRelatedTarget(e).tagName.toUpperCase() == "A") && 
				($.su.func.getRelatedTarget(e).className.indexOf("msg-close") != -1) ){
			return true;
		}
		return false;
	};

    $("input#reset-user-new-username").textbox({
        fieldLabel: $.su.CHAR.QUICK_SETUP.NEW_USERNAME,
        allowBlank: false,
        vtype: "name",
        checkFocusTarget: checkFocusTargetFunction,
        minLength:1,
        maxLength:15
    });
    setTimeout(function(){
        $("input#reset-user-new-username").focus();
    },10);
	
	var passwordCheck = function(new_pwd, cfm_val){
		
		if(cfm_val == new_pwd){
			resetUserConfirmPasswordStatus.status("setSuccess");
			return true;
		}else{
			resetUserConfirmPasswordStatus.status("setFailed");
			return false;
		};
	};

    var resetUserNewPassword = $("input#reset-user-new-password").password({
        fieldLabel: $.su.CHAR.QUICK_SETUP.NEW_PASSWORD,
        showLevel: true,
        allowBlank: false,
        vtype: "ascii_visible",
        minLength:1,
        maxLength:32
    }).on("ev_change", function(){
        resetUserConfirmPasswordStatus.status('setNormal');
        resetUserConfirmPassword.password('setNormal');
		
		var new_pwd = resetUserNewPassword.password("getValue");
		var cfm_val = resetUserConfirmPassword.password("getValue");
		if ( cfm_val){
			passwordCheck(new_pwd, cfm_val);
		}
    }).on("ev_validatechange", function(){	
		
		var new_pwd = resetUserNewPassword.password("getValue");
	    var cfm_val = resetUserConfirmPassword.password("getValue");

		if( cfm_val=='' ){
			resetUserConfirmPasswordStatus.status('setNormal');
			return true;
		}else{
			passwordCheck(new_pwd, cfm_val);
		};
    });

    var resetUserConfirmPassword = $("input#reset-user-confirm-password").password({
        fieldLabel: $.su.CHAR.QUICK_SETUP.CONFIRM_PASSWORD,
        showLevel: false,
        allowBlank: false,
        cls: "inline-block",
        vtype: "ascii_visible",
        minLength:1,
        maxLength:32
    }).on("ev_change ev_validatechange", function(){
		var new_pwd = resetUserNewPassword.password("getValue");
	    var cfm_val = resetUserConfirmPassword.password("getValue");
		
		if (new_pwd == ""){
			if ( cfm_val == "" ){
				resetUserConfirmPasswordStatus.status("setNormal");
			}else{
				if (!passwordCheck(new_pwd, cfm_val)){
					resetUserConfirmPassword.password("setError");
				};
			}
		}else{
			if (!passwordCheck(new_pwd, cfm_val)){
				resetUserConfirmPassword.password("setError");
			}
		}
	});

    var resetUserConfirmPasswordStatus = $("input#reset-user-confirm-password-status").status({
        cls: "inline-block"
    });

    $("button#btn-reset-user").button({
        text: $.su.CHAR.QUICK_SETUP.CONFIRM,
        cls: "submit",
        handler: function(){
            resetUserForm.form("submit", {
                "operation": "set"
            }, function(){
                resetUserMsg.msg("close");
            });
        }
    });

    var resetUserForm = $("div#reset-user-form").form({
        proxy: {
            url: $.su.url("/admin/administration?form=account")
        },
        fields: [
            {name: "new_pwd", mapping: "new_pwd"},
            {name: "new_acc", mapping: "new_acc"},
            {name: "cfm_pwd", mapping: "cfm_pwd"}
        ],
        submitBtn: "#btn-reset-user",
        validator: function(){
            var p1 = resetUserNewPassword.password("getValue");
            var p2 = resetUserConfirmPassword.password("getValue");
            if (p1 === p2){
                resetUserConfirmPasswordStatus.status("setSuccess");
                return true;
            }else{
                resetUserConfirmPassword.password("setError", $.su.CHAR.ERROR["00000080"]);
                return false;
            }
        }
    });
    //console.log("show resetUserMsg")
    resetUserMsg.msg("show");
}else{
    cloudSupportProxy.read({}, function(data){
        if (data.cloud_support == "yes") {
            var pageJumpProxy = new $.su.Proxy({
                async: false,
                url: URL_CHECK_JUMP,
                autoLoad: false
            });

            pageJumpProxy.read({}, function(data){
                $.su.app.jumpPage = data.page;
                $.su.nav.goTo(data.nav);
                //$("div#reset-user-msg-container").remove();
            }, function(){
                $.su.app.jumpPage = "network-map";
                $.su.nav.goTo("basic");
                //$("div#reset-user-msg-container").remove();
            }, function(){
                $.su.app.jumpPage = "network-map";
                $.su.nav.goTo("basic");
                $("div#reset-user-msg-container").remove();
            });       
        }
        else {
            $.su.app.jumpPage = "network-map";
            $.su.nav.goTo("basic");
            $("div#reset-user-msg-container").remove();       
        }
    });
};
/**********END*菜单部分效果*END**********/

/**********SRT*布局调整*SRT*********/
$.su.layout.doLayout = function(){
	// if ($.su.app.runningModule.name === "quick_setup" || $.su.app.runningModule.name === "ap_quick_setup"){
	// 	var wh = $(window).height();
	// 	var ww = $(window).width();
	// 	var fh = 0;//$("div.top-footer").height();
	// 	var	hh = $("div.top-header").height();

	// 	var w = Math.max(ww, 980);
	// 	var pl = parseInt((w - 980)/2, 10);//padding-left;
	// 	var c = $("div#quicksetup-form");

	// 	var ch = $("div#top-content").height();
	// 	var h = ch;
	// 	var min_h = Math.max( wh - fh - hh,328);
	// 	if (fh+hh+ch >= wh){
	// 		c.css("height", h);
	// 	}else{
	// 		c.css("height", wh - hh - fh);
	// 	};
	// 	/*$("div#quicksetup-form").css({
	// 		"padding-left": pl,
	// 		"padding-right": pl
	// 	});*/
	
		var wh = $(window).height();
		var	hh = $("div.top-header").height();
	var fh = $("div.top-footer").height();
	var ch = $("div#top-content").height();
	var mh = $("div.menu-container").height();


	var c = $("div.function-container");
	var pT = parseInt(c.css("paddingTop"), 10);
	var pB = parseInt(c.css("paddingBottom"), 10);

	$("div.content-container").css({
		"height": wh - hh
		});
	$("div.menu-container, div#quicksetup-form").css({
		"height": wh - hh - fh,
	});

	$("div.function-container").css({
		"height": wh - hh - fh - pT -pB,
	});

		$("div#quicksetup-form").niceScroll({
			cursorcolor:"#a4e5ea",  
			cursoropacitymax:1,  
			touchbehavior:false,
			cursorwidth:"7px",  
			cursorborder:"1px",  
			cursorborderradius:"17px",
			enablescrollonselection:false
		});
	// 	return;
	// };

	// var mh = $("div.menu-container").height(),
	// 	hh = $("div.top-header").height(),
	// 	fh = 0;//$("div.top-footer").height(),
	// 	wh = $(window).height(),
	// 	ww = $(window).width();

	// var th = $("div.top-main").height(),
	// 	ch = wh - hh - fh,
	// 	h = Math.max(mh, ch);
	// //var w = Math.max(ww, 980);
	// var w = Math.max(ww, 1032);

	// var c = $("div.function-container");
	// var pT = parseInt(c.css("paddingTop"), 10);
	// var pB = parseInt(c.css("paddingBottom"), 10);
	// //var pl = parseInt((w - 980)/2, 10);//padding-left;
	// var pl = parseInt((w - 1032)/2, 10);//padding-left;
	// var pr = pl + 50;//padding-right;
	// var func_ml = pl + 224;//func-container margin-left

	// $("div.menu-container").css({
	// 	//"min-height": h - pT -pB,
	// 	"height": wh - hh - fh,
	// 	// "padding-left": pl
	// });
	// $("div.function-container").css({
	// 	//"min-height": h - pT -pB,
	// 	"height": wh - hh - fh - pT -pB,
	// 	//"padding-right": pr,
	// 	// "padding-right": 50,
	// 	// "margin-left": func_ml
	// });
	$("div.help-container").css({
		"right": $("#top-content").offset().left + 15 + "px",
		"top": "23px"
	 	
	});

	$("div.menu-container").niceScroll({
		cursorcolor:"#a4e5ea",  
		cursoropacitymax:1,  
		touchbehavior:false,  
		cursorwidth:"7px",  
		cursorborder:"1px",  
		cursorborderradius:"17px",
		enablescrollonselection:false
	});
	$("div.function-container").niceScroll({
		cursorcolor:"#a4e5ea",  
		cursoropacitymax:1,  
		touchbehavior:false,
		cursorwidth:"7px",  
		cursorborder:"1px",  
		cursorborderradius:"17px",
		enablescrollonselection:false
	});
};
/**********END*布局调整*END*********/

/**页面初始化**/
$(window).on("resize load", function(){
    $.su.layout.doLayout();
});

$(".close-layer").click(function(){
	$(".index-update-alert-cnt").hide();
	checkUpgradeNoShowProxy.write({}, 
		function(data){

		},
		function(){

		},
		function(){

	});
});
cloudSupportProxy.read({}, function(data){
    if (data.cloud_support == "yes") {
    	checkUpgradeVersionProxy.read({}, function(data){
    		if(data.type == 3)
    		{
    			$("span#index-update-alert").html($.su.CHAR.INDEX.UPGRADE_ALERT_2);
    			$(".index-update-alert-cnt").show();    
    		}
    		else if(data.type == 2)
    		{
    			$("span#index-update-alert").html($.su.CHAR.INDEX.UPGRADE_ALERT_1);
    			$(".index-update-alert-cnt").show();
    		}
    		else
    		{
    			$(".index-update-alert-cnt").hide();
    		}
    	},function(){
    		$(".index-update-alert-cnt").hide();
    	},function(){
    		$("span#index-update-alert").html($.su.CHAR.INDEX.UPGRADE_ALERT_1);
    		$(".index-update-alert-cnt").hide();
    	});
        checkUpgradeProxy.read({}, function(data){
            if(data.update_number > 0)
            {
                $("span#upgrade-hint").html(data.update_number);
                $("#top-control-update").show();
            }
            else
            {
                $("#top-control-update").hide();
            }
        });
    }
});

});
//]]>
</script>
</body>
</html>
