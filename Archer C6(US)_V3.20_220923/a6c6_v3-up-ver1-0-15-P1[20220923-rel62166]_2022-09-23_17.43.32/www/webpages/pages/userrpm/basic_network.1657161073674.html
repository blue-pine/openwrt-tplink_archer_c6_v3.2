<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Internet</title>
</head>

<body>
<div class="func-container">

    
    <div id="map-container">

		<div class="map_wrap">
			<div id="map_internet" class="map-internet map-internet-connect">
				<div id="map_icon_internet" class="map-icon-internet selected">
					<span id="map_icon_internet_status" class="map-icon-internet-status hidden"></span>
				</div>
				<p id="map_internet_p"></p>
			</div>

			<div id="map_router" class="map-router">
				<div id="map_icon_router" class="map-icon-router"></div>
				<p id="map_router_p"></p>
				<div id="map_router_tip" class="map-router-tip">
					<div id="map_router_24g" class="map-router-wrap">
						<div id="map_router_24g_img" class="map-router-24g-img"></div>
						<p id="map_router_24g_text"></p>
					</div>
					<div class="map-router-bar"></div>
					<div id="map_router_5g" class="map-router-wrap">
						<div id="map_router_5g_img" class="map-router-24g-img"></div>
						<p id="map_router_5g_text"></p>
					</div>
					<div class="map-router-bar-52g hidden"></div>
					<div id="map_router_52g" class="map-router-wrap">
						<div id="map_router_52g_img" class="map-router-24g-img"></div>
						<p id="map_router_52g_text"></p>
					</div>
				</div>
			</div>


			<div id="map_mesh" class="map-mesh hidden">
				<div id="map_icon_mesh" class="map-icon-mesh">
					<span id="map_num_mesh" class="map-icon-num">0</span>
				</div>
				<p id="map_mesh_p"></p>
			</div>
			
			<div class="map-line-horizontal"></div>
			<div id="map-line-router-mesh" class="map-line-horizontal hidden"></div>
			<div id="map_line_vertical" class="map-line-vertical line-vertical-without-usb"></div>
			<div id="map_line_branch" class="map-line-branch hidden"></div>

			<div id="map_wire_model" class="map-wrap-left wireless-without-usb">

				<div id="map_wire" class="map-wire">
					<div id="map_icon_wire" class="map-icon-wire">
						<span id="map_num_wire" class="map-icon-num hidden"></span>
					</div>
					<p id="map_wire_p"></p>
				</div>
				
				<div id="map_wireless" class="map-wireless">
					<div id="map_icon_wireless" class="map-icon-wireless">
						<span id="map_num_wireless" class="map-icon-num hidden"></span>
					</div>
					<p id="map_wireless_p"></p>
				</div>
			</div>


			<div id="map_usb_model" class="map-wrap-right no-printer hidden">
				<div id="map_printer" class="map-printer hidden">
					<div id="map_icon_printer" class="map-icon-printer">
					</div>
					<p id="map_printer_p"></p>
				</div>

				<div id="map_usb" class="map-usb">
					<div id="map_icon_usb" class="map-icon-usb">
						<span id="map_icon_usb_qs" class="map-icon-usb-qs hidden"></span>
					</div>
					<p id="map_usb_p"></p>
				</div>
			</div>

		</div>

		<form id="basic_network_form">

			<div id="internet_panel" class="map-panel">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-internet"></span>
					<span class="map-panel-icon-text" id="map_title_internet"></span>
				</h4>
				<div id="network_internet_form" class="map-panel-cnt hidden">
					<input id="internet_status" name="status"/>
					<input id="internet_mac" name="wan_macaddr"/>
					<input id="internet_conn_type" name="wan_ipv4_conntype"/>
					<input id="internet_ip_address" name="wan_ipv4_ipaddr"/>
					<input id="internet_mask" name="wan_ipv4_netmask"/>
					<input id="ap_internet_conn_type" name="wan_ipv4_conntype"/>
					<input id="internet_snd_conn" name="wan_ipv4_snd_conn"/>
					<input id="internet_snd_ip" name="wan_ipv4_snd_ipaddr"/>
				</div>
				<div id="network_modem_form" class="map-panel-cnt hidden">
					<input id="internet_modem_status" name="modem_status"/>
					<input id="internet_modem_ip" name="modem_ipaddr"/>
					<input id="internet_modem_signal" name="modem_signal"/>
				</div>
				<div id="ap_network_form" class="map-panel-cnt hidden">
					<input id="network_mac" name="macaddr"/>
					<input id="network_ip" name="ipaddr"/>
					<input id="network_mask" name="mask_type"/>
					<input id="network_type" name="lan_type"/>
				</div>
			</div>
			
			<div id="router_panel" class="map-panel hidden">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-router"></span>
					<span class="map-panel-icon-text" id="map_title_router"></span>
				</h4>
				<div id="" class="map-panel-cnt">
					<div id="router_wireless_24g" class="map-form-left">
						<h5 id="router_wireless_24g_title" class="map-form-title"></h5>
						<!-- <input id="router_wireless_24g_ssid" name="wireless_2g_ssid"/> -->
						<p class="status-textarea-read">
				    		<label id="wireless_2g_ssid_label" class="xxs"></label>
				    		<span id="wireless_2g_ssid"></span>
				    	</p>
						<input id="router_wireless_24g_channel" name="wireless_2g_channel"/>
						<input id="router_wireless_24g_mac" name="wireless_2g_macaddr"/>
					</div>
                    <div id="router_guest_24g" class="map-form-right">
						<h5 id="router_guest_24g_title" class="map-form-title"></h5>
						<input id="router_guest_24g_status" name="guest_2g_enable"/>
						<!-- <input id="router_guest_24g_ssid" name="guest_2g_ssid"/> -->
						<p class="status-textarea-read">
				    		<label id="guest_2g_ssid_label" class="xxs"></label>
				    		<span id="guest_2g_ssid"></span>
				    	</p>
					</div>


					<div id="router_wireless_5g" class="map-form-left">
						<h5 id="router_wireless_5g_title" class="map-form-title"></h5>
						<!-- <input id="router_wireless_5g_ssid" name="wireless_5g_ssid"/> -->
						<p class="status-textarea-read">
				    		<label id="wireless_5g_ssid_label" class="xxs"></label>
				    		<span id="wireless_5g_ssid"></span>
				    	</p>
						<input id="router_wireless_5g_channel" name="wireless_5g_channel"/>
						<input id="router_wireless_5g_mac" name="wireless_5g_macaddr"/>
					</div>
					
					<div id="router_guest_5g" class="map-form-right">
						<h5 id="router_guest_5g_title" class="map-form-title"></h5>
						<input id="router_guest_5g_status" name="guest_5g_enable"/>
						<!-- <input id="router_guest_5g_ssid" name="guest_5g_ssid"/> -->
						<p class="status-textarea-read">
				    		<label id="guest_5g_ssid_label" class="xxs"></label>
				    		<span id="guest_5g_ssid"></span>
				    	</p>
					</div>


					<div id="router_wireless_52g" class="map-form-left">
						<h5 id="router_wireless_52g_title" class="map-form-title"></h5>
						<!-- <input id="router_wireless_5g_ssid" name="wireless_5g_ssid"/> -->
						<p class="status-textarea-read">
				    		<label id="wireless_52g_ssid_label" class="xxs"></label>
				    		<span id="wireless_52g_ssid"></span>
				    	</p>
						<input id="router_wireless_52g_channel" name="wireless_5g_2_channel"/>
						<input id="router_wireless_52g_mac" name="wireless_5g_2_macaddr"/>
					</div>
					<div id="router_guest_52g" class="map-form-right">
						<h5 id="router_guest_52g_title" class="map-form-title"></h5>
						<input id="router_guest_52g_status" name="guest_5g_2_enable"/>
						<!-- <input id="router_guest_5g_ssid" name="guest_5g_ssid"/> -->
						<p class="status-textarea-read">
				    		<label id="guest_52g_ssid_label" class="xxs"></label>
				    		<span id="guest_52g_ssid"></span>
				    	</p>
					</div>
				</div>
				<h4 class="map-panel-title">
					<span class="map-panel-icon-lan"></span>
					<span class="map-panel-icon-text" id="map_title_lan"></span>
				</h4>
				<div id="lan_traffic_grid"></div>
			</div>
			
			<div id="wireless_host_panel" class="map-panel hidden">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-wireless"></span>
					<span class="map-panel-icon-text" id="map_title_wireless_host"></span>
					<div id="wireless-device-container">
						<span class="wireless-device wireless-host selected"></span>
						<span class="wireless-device-separa"></span>
						<span class="wireless-device wireless-guest"></span>
					</div>
				</h4>
				<div id="" class="map-panel-cnt">
					<div id="map_grid_wireless_host">
					</div>
				</div>
			</div>

			<div id="wireless_guest_panel" class="map-panel hidden">
				<div id="" class="map-panel-cnt">
					<div id="map_grid_wireless_guest">
					</div>
				</div>
			</div>
			
			<div id="wire_panel" class="map-panel hidden">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-wire"></span>
					<span class="map-panel-icon-text" id="map_title_wire"></span>
				</h4>
				<div id="" class="map-panel-cnt">
					<div id="map_grid_wire">
					</div>
				</div>
			</div>
			
			<div id="printer_panel" class="map-panel hidden">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-printer"></span>
					<span class="map-panel-icon-text" id="map_title_printer"></span>
				</h4>
				<div id="" class="map-panel-cnt">
					<input id="printer_name" name="printer_name"/>
				</div>
			</div>
			
			<div id="mesh_panel" class="map-panel hidden">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-mesh"></span>
					<span class="map-panel-icon-text" id="map_title_mesh"></span>
				</h4>
				<div class="map-panel-cnt">
					<div id="map_grid_mesh" class="hidden"></div>
					<div id="map_grid_mesh_editor">
						<input type="text" id="mesh-device-name" name="name"/>
						<input type="text" id="mesh-device-location" name="location"/>
						<input type="text" id="mesh-device-mac" name="mac"/>
					</div>
					<div id="map_mesh_no_devices">
						<p id="no-mesh-device-note-1" class="note first-line"></p>
						<p id="no-mesh-device-note-2" class="note"></p>
					</div>
				</div>
			</div>

			<div id="usb_panel" class="map-panel hidden">
				<h4 class="map-panel-title">
					<span class="map-panel-icon-usb"></span>
					<span class="map-panel-icon-text" id="map_title_usb"></span>
				</h4>
				<div id="" class="map-panel-cnt">
	     			<input id="usb_storage_brand" type="text" name="storage_vendor"/>
	     			<p class="usb-form-line">
	     				<span id="usb_storage_label_total" class="usb-storage-label"></span>
	     				<span id="usb_storage_total" class="usb-input-blue" name="storage_capacity"></span>
	     				<span id="usb_storage_total_unit" type="text" name="storage_capacity_unit"></span>
	     			</p>
	     			<p class="usb-form-line">
	     				<span id="usb_storage_label_available" class="usb-storage-label"></span>
	     				<span id="usb_storage_available" class="usb-input-blue" name="storage_available"></span>
	     				<span id="usb_storage_available_unit" type="text" name="storage_available_unit"></span>
	     			</p>
				</div>
			</div>
			<div id="cmoc-tips" class="hidden">
				<div class="tips-content-container" >
					<div class="position-top-left"></div>
					<div class="position-top-center"></div>
					<div class="position-top-right"></div>
					<div class="position-center-left">
						<div class="position-center-right">
							<div class="tips-content-wrap">
								<div class="tips-content-container-wrap">
									<div class="tips-content">
										<div id="CMOC_loading"></div>
										<div id="CMOC">
											<ul>
												<li>
													<div class="CMOC_title">
													</div>
													<div class="CMOC_content">
													</div>
												</li>
												<li>
													<div class="CMOC_title">
													</div>
													<div class="CMOC_content">
													</div>
												</li>
												<li>
													<div class="CMOC_title">
													</div>
													<div class="CMOC_content">
													</div>
												</li>
												<li>
													<div class="CMOC_title">
													</div>
													<div class="CMOC_content">
													</div>
												</li>
												<li>
													<div class="CMOC_title">
													</div>
													<div class="CMOC_content">
													</div>
												</li>
												<li>
													<div class="CMOC_title">
													</div>
													<div class="CMOC_content">
													</div>
												</li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="position-bottom-left"></div>
					<div class="position-bottom-center"></div>
					<div class="position-bottom-right"></div>
				</div>
			</div>

		</form>
		
    </div>
    <div id="speedTest_panel" class="map-panel nd hidden">
    <div id="basic_network_help"></div>
    
</div>

<script type="text/javascript">
//<![CDATA[
try{
    $
}catch(e){
    location.href = "/";
};

$(document).ready(function(e){
	$.su.module = $.su.module || {};
	var tribandModule = $.su.module.triband.basicNetWork();
	var scheduleModule = $.su.module.wirelessSchedule.basicNetWork();
	var usbModule = $.su.module.suppUsb.basicNetWork();
	var printerModule = $.su.module.printer.basicNetWork();
	if($.su.module.support_one_mesh){
		$('#map_mesh').removeClass('hidden')
		$('#map-line-router-mesh').removeClass('hidden')
	}
	if(window.sysMode!="ap"){
		var speedtest_disable = $.su.module.speedtest_disable || false;
		if (speedtest_disable == false)
		{
			$('#speedTest_panel').load('./pages/userrpm/speedTest.1657161073674.html');
		}
	}

	var internetProxy = new $.su.Proxy({ url: "./data/basic.network.internet.json" });
	var internetProxy_URL = new $.su.Proxy({ url: $.su.url('/admin/basic?form=internet') });
	var URL_REGION_NEW = $.su.url("/admin/wireless?form=region");
	var networkProxy = new $.su.Proxy({
		url:$.su.url("/admin/network?form=lan_ipv4")
	});
	
	$('span#usb_storage_label_total').html($.su.CHAR.STATUS.TOTAL);
	$('span#usb_storage_label_available').html($.su.CHAR.STATUS.AVAILABLE);

	$("div#map_grid_wireless_host").grid({
		store:{
		//	proxy: wireless24gGridProxy,
			fields: [
				{name: "hostname"},
				{name: "ipaddr"},
				{name: "macaddr"}
			],
			autoLoad: true
		},
		minLines: 0,
		maxLines: 5,
		columns: [
			{
				text: $.su.CHAR.GRID_ID_COLUMN, 
				xtype: "rownumberer",
				width:40
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.NAME, 
				dataIndex: "hostname",
				width: 260,
				renderer:function(value, index, data){
					var inHTML="<input id=\"wireless_host_"+index+"\" />";
						inHTML+="<div class=\"name_content_container\" id=\"wireless_host_content_"+index+"\"><span class=\"name\">"+$.su.func.escapeHtml(value)+"</span><div class=\"name_editor\"></div></div>";
					setTimeout(function(){
						$("#wireless_host_"+index).textbox({
							inputCls:"l"
						});
						$("#wireless_host_"+index).textbox("hide").textbox("setValue", value);
					},100);
					$("#map_grid_wireless_host").on("click","#wireless_host_content_"+index+" .name_editor",function(){
						clearInterval(getClientsDataRefreshId);
						$(this).parent().hide();
						$("#wireless_host_"+index).textbox("show").focus();
					});
					$("#map_grid_wireless_host").on("keydown","#wireless_host_"+index,function(e){
						if(e.keyCode==13){
							$(this).blur();
						}
					});
					$("#map_grid_wireless_host").on("blur","#wireless_host_"+index,function(){
						var _this=this;
						$(this).textbox("hide");
						$("#wireless_host_content_"+index).show();
						if($(this).textbox("getValue")==$("#wireless_host_content_"+index).text() || $(this).textbox("getValue")=="")return;
						else{
							var SYS_DEVICE_NEW = $.su.url("/admin/traffic?form=dev_name");
							var deviceProxy = new $.su.Proxy({
								url: SYS_DEVICE_NEW
							});
							deviceProxy.write({
								key:"key-"+index,
								index:index,
								alias:$(this).textbox("getValue"),
								mac:$("div#map_grid_wireless_host").grid("getStore").data[index].macaddr
							},function(data){
								$("#wireless_host_content_"+index).html("<span class=\"name\"></span><div class=\"name_editor\"></div></div>");
								$("#wireless_host_content_"+index+" span.name").text($(_this).textbox("getValue"));
								clearInterval(getClientsDataRefreshId);
								getClientsDataRefreshId = setInterval(getClientsData, 10*1000);
							});
						}
						
					});
					return inHTML;
				}
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.IP_ADDR, 
				width: 160,
				dataIndex: "ipaddr"
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.MAC_ADDR,
				dataIndex: "macaddr"
			}
		]

	});
	
	$("div#map_grid_wireless_guest").grid({
		store:{
		//	proxy: wireless24gGridProxy,
			fields: [
				{name: "hostname"},
				{name: "ipaddr"},
				{name: "macaddr"}
			],
			autoLoad: true
		},
		minLines: 0,
		maxLines: 5,
		columns: [
			{
				text: $.su.CHAR.GRID_ID_COLUMN, 
				xtype: "rownumberer",
				width:40
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.NAME, 
				dataIndex: "hostname",
				width: 260,
				renderer:function(value, index, data){
					var inHTML="<input id=\"wireless_guest_"+index+"\" />";
						inHTML+="<div class=\"name_content_container\" id=\"wireless_guest_content_"+index+"\"><span class=\"name\">"+$.su.func.escapeHtml(value)+"</span><div class=\"name_editor\"></div></div>";
					setTimeout(function(){
						$("#wireless_guest_"+index).textbox({
							inputCls:"l"
						});
						$("#wireless_guest_"+index).textbox("hide").textbox("setValue", value);
					},100);
					$("#map_grid_wireless_guest").on("click","#wireless_guest_content_"+index+" .name_editor",function(){
						clearInterval(getClientsDataRefreshId);
						$(this).parent().hide();
						$("#wireless_guest_"+index).textbox("show").focus();
					});
					$("#map_grid_wireless_guest").on("keydown","#wireless_guest_"+index,function(e){
						if(e.keyCode==13){
							$(this).blur();
						}
					});
					$("#map_grid_wireless_guest").on("blur","#wireless_guest_"+index,function(){
						var _this=this;
						$(this).textbox("hide");
						$("#wireless_guest_content_"+index).show();
						if($(this).textbox("getValue")==$("#wireless_guest_content_"+index).text())return;
						else{
							var SYS_DEVICE_NEW = $.su.url("/admin/traffic?form=dev_name");
							var deviceProxy = new $.su.Proxy({
								url: SYS_DEVICE_NEW
							});
							deviceProxy.write({
								key:"key-"+index,
								index:index,
								alias:$(this).textbox("getValue"),
								mac:$("div#map_grid_wireless_guest").grid("getStore").data[index].macaddr
							},function(data){
								$("#wireless_guest_content_"+index).html("<span class=\"name\"></span><div class=\"name_editor\"></div></div>");
								$("#wireless_guest_content_"+index+" span.name").text($(_this).textbox("getValue"));
								clearInterval(getClientsDataRefreshId);
								getClientsDataRefreshId = setInterval(getClientsData, 10*1000);
							});
						}
						
					});
					return inHTML;
				}
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.IP_ADDR, 
				width: 160,
				dataIndex: "ipaddr"
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.MAC_ADDR,
				dataIndex: "macaddr"
			}
		]

	});
	


	$("div#map_grid_wire").grid({
		store:{
		//	proxy: wireless5gGridProxy,
			fields: [
				{name: "hostname"},
				{name: "ipaddr"},
				{name: "macaddr"}
			],
			autoLoad: true
		},
		minLines: 0,
		maxLines: 5,
		columns: [
			{
				text: $.su.CHAR.GRID_ID_COLUMN, 
				xtype: "rownumberer",
				width:40
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.NAME, 
				dataIndex: "hostname",
				width: 260,
				renderer:function(value, index, data){
					var dataTmp=[];
					dataTmp[index]=value;
					var inHTML="<input id=\"wired_clients_"+index+"\" />";
						inHTML+="<div class=\"name_content_container\" id=\"wired_client_content_"+index+"\"><span class=\"name\">"+$.su.func.escapeHtml(value)+"</span><div class=\"name_editor\"></div></div>";
					setTimeout(function(){
						$("#wired_clients_"+index).textbox({
							inputCls:"l"
						});
						$("#wired_clients_"+index).textbox("hide").textbox("setValue",dataTmp[index]);
					},100);
					$("#map_grid_wire").on("click","#wired_client_content_"+index+" .name_editor",function(){
						clearInterval(getClientsDataRefreshId);
						$(this).parent().hide();
						$("#wired_clients_"+index).textbox("show").focus();
					});
					$("#map_grid_wire").on("keydown","#wired_clients_"+index,function(e){
						if(e.keyCode==13){
							$(this).blur();
						}
						
					});
					$("#map_grid_wire").on("blur","#wired_clients_"+index,function(){
						var _this=this;
						$(this).textbox("hide");
						$("#wired_client_content_"+index).show();
						if($(this).textbox("getValue")==$("#wired_client_content_"+index).text())return;
						else{
							var SYS_DEVICE_NEW = $.su.url("/admin/traffic?form=dev_name");
							var deviceProxy = new $.su.Proxy({
								url: SYS_DEVICE_NEW
							});
							deviceProxy.write({
								key:"key-"+index,
								index:index,
								alias:$(this).textbox("getValue"),
								mac:$("div#map_grid_wire").grid("getStore").data[index].macaddr
							},function(data){
								$("#wired_client_content_"+index).html("<span class=\"name\"></span><div class=\"name_editor\"></div></div>");
								$("#wired_client_content_"+index+" span.name").text($(_this).textbox("getValue"));
								clearInterval(getClientsDataRefreshId);
								getClientsDataRefreshId = setInterval(getClientsData, 10*1000);
							});
						}
						
					});
					return inHTML;
				}
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.IP_ADDR, 
				width: 160,
				dataIndex: "ipaddr"
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.MAC_ADDR,
				dataIndex: "macaddr"
			}
		]

	});
	var cur_region_data = {};
	var regionProxy = new $.su.Proxy({
		url: URL_REGION_NEW,
		async: false
	});

	var conn_type;

	$("div.func-container").page({
		title: $.su.CHAR.BASIC_INTERNET.TITLE,
		help: ""	//可能是个调用的id 也可能是个url
	});

	printerModule.init(clearStatus);

	$('p#map_internet_p').html(sysMode=="ap"?$.su.CHAR.MENU.NETWORK:$.su.CHAR.BASIC_NETWORK.INTERNET);
	$('p#map_router_p').html($.su.locale.model.replace(/.*?router\s+/ig,"") || $.su.locale.model || $.su.CHAR.BASIC_NETWORK.ROUTER);
	$('p#map_wireless_p').html($.su.CHAR.BASIC_NETWORK.WIRELESS_CLIENTS);
	$('p#map_wire_p').html($.su.CHAR.BASIC_NETWORK.WIRE_CLIENTS);
	$('p#map_usb_p').html($.su.CHAR.BASIC_NETWORK.USB_DISK);

	$('p#map_router_24g_text').html($.su.CHAR.BASIC_NETWORK.GHZ24);
	$('p#map_router_5g_text').html($.su.CHAR.BASIC_NETWORK.GHZ5);

	$('span#map_title_internet').html(sysMode=="ap"?$.su.CHAR.MENU.NETWORK:$.su.CHAR.BASIC_NETWORK.INTERNET);
	$('span#map_title_router').html($.su.CHAR.BASIC_NETWORK.WIRELESS);
	$('span#map_title_lan').html($.su.CHAR.BASIC_NETWORK.ETHERNET);
	$('span#map_title_wireless_host').html($.su.CHAR.BASIC_NETWORK.WIRELESS_CLIENTS);
	$('div#wireless-device-container span.wireless-host').html($.su.CHAR.STATUS.HOST);
	$('div#wireless-device-container span.wireless-guest').html($.su.CHAR.STATUS.GUEST);
	$('span#map_title_wire').html($.su.CHAR.BASIC_NETWORK.WIRE_CLIENTS);
	$('span#map_title_printer').html($.su.CHAR.BASIC_NETWORK.PRINTER);
	$('span#map_title_usb').html($.su.CHAR.BASIC_NETWORK.USB_DISK);

	$('h5#router_wireless_24g_title').html($.su.CHAR.BASIC_NETWORK.WIRELESS_24GHZ);
	$('h5#router_wireless_5g_title').html($.su.CHAR.BASIC_NETWORK.WIRELESS_5GHZ);
	$('h5#router_guest_24g_title').html($.su.CHAR.BASIC_NETWORK.GUEST_24GHZ);
	$('h5#router_guest_5g_title').html($.su.CHAR.BASIC_NETWORK.GUEST_5GHZ);

	printerModule.show();

	regionProxy.read({}, function(data){
		cur_region_data = data.capability;
	});
	var channel_5g = cur_region_data.channel_5g;
	
	function clearStatus(){
		$('div#map_icon_internet').removeClass('selected');
		$('div#map_icon_router').removeClass('map-icon-router-conn');
		$('div#map_icon_wireless').removeClass('map-icon-wireless-conn');
		$('div#map_icon_wire').removeClass('map-icon-wire-conn');
		$('div#map_icon_mesh').removeClass('map-icon-mesh-conn');
		$('div#map_icon_printer').removeClass('map-icon-printer-conn');
		$('div#map_icon_usb').removeClass('map-icon-usb-conn');

		$('div#internet_panel').hide();	
		$('div#router_panel').hide();	
		$('div#wireless_host_panel').hide();	
		$('div#wireless_guest_panel').hide();	
		$('div#wire_panel').hide();	
		$('div#mesh_panel').hide();	
		$('div#printer_panel').hide();	
		$('div#usb_panel').hide();	
		if(window.sysMode!="ap"){
			$('div#speedTestResume-container').removeClass('selected');
		$('div#speedTest_panel').hide();	
	}
	}

////////////////////////////// form init

	var onoffTrans = function(str){
		if(str.toUpperCase() == 'ON'){
			return $.su.CHAR.STATUS.ON;
		}else{
			return $.su.CHAR.STATUS.OFF;
		};
	};

	tribandModule.init();

	var formFields = [
		//	{name: "wan_ipv4_conntype", mapping: "wan_ipv4_conntype"},
			{name: "wan_ipv4_ipaddr", mapping: "wan_ipv4_ipaddr"},
			{name: "wan_macaddr", mapping: "wan_macaddr"},
			{name: "wan_ipv4_netmask", mapping: "wan_ipv4_netmask"},

		{name: "modem_status", mapping: "modem_status"},
		{name: "modem_ipaddr", mapping: "modem_ipaddr"},
		{name: "modem_signal", mapping: "modem_signal"},

			{name: "wireless_2g_ssid", mapping: "wireless_2g_ssid"},
		//	{name: "wireless_2g_channel", mapping: "wireless_2g_channel"},
			{name: "wireless_2g_macaddr", mapping: "wireless_2g_macaddr"},
			{name: "wireless_5g_ssid", mapping: "wireless_5g_ssid"},
		//	{name: "wireless_5g_channel", mapping: "wireless_5g_channel"},
			{name: "wireless_5g_macaddr", mapping: "wireless_5g_macaddr"},

			//{name: "guest_2g_enable", mapping: "guest_2g_enable"},
			{name: "guest_2g_ssid", mapping: "guest_2g_ssid"},
			// {name: "guest_5g_enable", mapping: "guest_5g_enable"},
			{name: "guest_5g_ssid", mapping: "guest_5g_ssid"},

			// {name: "printer_name", mapping: "printer_name"},

			//{name: "storage_vendor", mapping: "storage_vendor"},

			{name: "storage_capacity", mapping: "storage_capacity"},
			{name: "storage_capacity_unit", mapping: "storage_capacity_unit"},
			{name: "storage_available", mapping: "storage_available"},
			{name: "storage_available_unit", mapping: "storage_available_unit"}
	];

	formFields = tribandModule.extendField(formFields);
	$("form#basic_network_form").form({
		fields: formFields,
		submitBtn: false,
		autoLoad: true
	}).on("ev_loadData", function(e, data){
		if (data){
			//2g
			var guest_2g_radio_status = data.guest_2g_enable;
			if(data.wireless_2g_enable.toUpperCase() == 'OFF' || data.guest_2g_disabled.toUpperCase() == 'ON'){
				guest_2g_radio_status = 'OFF';
			}

			$("input#router_guest_24g_status").textbox("setValue", onoffTrans(guest_2g_radio_status));
			scheduleModule.resetStatus($("input#router_guest_24g_status"), guest_2g_radio_status);

			$("#wireless_2g_ssid").html($.su.func.escapeHtml(data.wireless_2g_ssid));
			$("#guest_2g_ssid").html($.su.func.escapeHtml(data.guest_2g_ssid));

			//5g
			var guest_5g_radio_status = data.guest_5g_enable;
			if(data.wireless_5g_enable.toUpperCase() == 'OFF' || data.guest_5g_disabled.toUpperCase() == 'ON'){
				guest_5g_radio_status = 'OFF';
			}
			$("input#router_guest_5g_status").textbox("setValue", onoffTrans(guest_5g_radio_status));
			scheduleModule.resetStatus($("input#router_guest_5g_status"), guest_5g_radio_status);

			$("#wireless_5g_ssid").html($.su.func.escapeHtml(data.wireless_5g_ssid));
			$("#guest_5g_ssid").html($.su.func.escapeHtml(data.guest_5g_ssid));

			//5g_2
			tribandModule.evLoadData(data, onoffTrans);

			usbModule.setBrand(data);

			if(data.printer_count == 0){
				$("input#printer_name").textbox("setValue",$.su.CHAR.PRINT.NONE);
			}else{
				$("input#printer_name").textbox("setValue", data.printer_name);
			}
		}
	});

	usbModule.init();

	var statusProxy = new $.su.Proxy({
		url: $.su.url('/admin/status?form=all')
	});

	function changeIcon(enable, disable, encryption, icon){
		if( enable.toUpperCase()=='OFF' || disable.toUpperCase()=='ON'){
			icon.removeClass('not-secure');
			icon.addClass('not-open');
		}else if(  enable.toUpperCase()=='ON' && disable.toUpperCase()=='OFF' && encryption.toUpperCase()=='NONE' ){
			icon.removeClass('not-open');
			icon.addClass('not-secure');
		}else if( enable.toUpperCase()=='ON' && disable.toUpperCase()=='OFF' &&  encryption.toUpperCase()!='NONE' ){
			icon.removeClass('not-open');
			icon.removeClass('not-secure');
		}
	}

	var getClientsDataProxy = new $.su.Proxy({
		url: $.su.url('/admin/status?form=client_status')
	});
	var getClientsData = function(){
		getClientsDataProxy.read({}, function(data){
			var wirelessCount = 0;
			if( data.access_devices_wireless_host && data.access_devices_wireless_host.length >0){
				$("div#map_grid_wireless_host").grid('getStore').loadData(data.access_devices_wireless_host);
				wirelessCount += data.access_devices_wireless_host.length;
			}else{
				$("div#map_grid_wireless_host").grid('getStore').loadData([]);
			}

			if( data.access_devices_wireless_guest && data.access_devices_wireless_guest.length >0){
				$("div#map_grid_wireless_guest").grid('getStore').loadData(data.access_devices_wireless_guest);
				wirelessCount += data.access_devices_wireless_guest.length;
			}else{
				$("div#map_grid_wireless_guest").grid('getStore').loadData([]);		
			}	
			$('span#map_num_wireless').show();
			$('span#map_num_wireless').html(wirelessCount);
		
			if( data.access_devices_wired && data.access_devices_wired.length >0){
				$("div#map_grid_wire").grid('getStore').loadData(data.access_devices_wired);
				$('span#map_num_wire').show();
				$('span#map_num_wire').html(data.access_devices_wired.length);
			}else{
				$("div#map_grid_wire").grid('getStore').loadData([]);
				$('span#map_num_wire').show();
				$('span#map_num_wire').html(0);
			}
		});
	};

	var getClientsDataRefreshId = null;

	getClientsData();
	if (!getClientsDataRefreshId)
	{
		getClientsDataRefreshId = setInterval(getClientsData, 10*1000);
	}


	var statusRefreshId = null;

	statusRead();
	if (!statusRefreshId)
	{
		statusRefreshId = setInterval(statusRead, 10*1000);
	}

	function statusRead(){
	scheduleModule.statusRead();
	statusProxy.read({}, function(data, status, xhr){
		$("form#basic_network_form").form('loadData', data);

		function transType(type, item){
			switch(type){
				case 'dhcp':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.DYNAMIC_IP);
					break;
				case 'static':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.STATIC_IP);
					break;
				case 'pppoe':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.PPPOE);
					break;
				case 'bigpond':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.BIGPOND_CABLE);
					break;
				case 'l2tp':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.L2TP);
					break;
				case 'pptp':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.PPTP);
					break;
				case 'dslite':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.DSLITE);
					break;
				case 'v6plus':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.V6_PLUS);
					break;
				case 'ocn':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.OCN);
					break;
				case 'none':
					item.textbox('setValue', $.su.CHAR.BASIC_NETWORK.NONE);
					break;
			}
		}

		transType( data.wan_ipv4_conntype, $('input#internet_conn_type') );
		transType( data.wan_ipv4_conntype, $('input#ap_internet_conn_type') );

		var numberTest = new $.su.vtype({
            vtype: "number"
		});

		if( data.wireless_2g_channel.toUpperCase()=='AUTO' ){
			$("input#router_wireless_24g_channel").textbox('setValue', $.su.CHAR.BASIC_NETWORK.AUTO + ' (' + $.su.CHAR.STATUS.CURRENT_CHANNEL + ' ' + data.wireless_2g_current_channel + ')');
		}else if( numberTest.validate(data.wireless_2g_current_channel) ){
			$("input#router_wireless_24g_channel").textbox('setValue', data.wireless_2g_current_channel );
		}else{
			$("input#router_wireless_24g_channel").textbox('setValue', data.wireless_2g_channel );
		}

		if( data.wireless_5g_channel.toUpperCase()=='AUTO' ){
			$("input#router_wireless_5g_channel").textbox('setValue', $.su.CHAR.BASIC_NETWORK.AUTO + ' (' + $.su.CHAR.STATUS.CURRENT_CHANNEL + ' ' + data.wireless_5g_current_channel + ')');
		}else if( numberTest.validate(data.wireless_5g_current_channel) ){
			$("input#router_wireless_5g_channel").textbox('setValue', data.wireless_5g_current_channel );
		}else{
			$("input#router_wireless_5g_channel").textbox('setValue', data.wireless_5g_channel );
		}

		$('span#usb_storage_total').html(data.storage_capacity);
		$('span#usb_storage_total_unit').html(data.storage_capacity_unit);
		$('span#usb_storage_available').html(data.storage_available);
		$('span#usb_storage_available_unit').html(data.storage_available_unit);

		changeIcon(data.wireless_2g_enable, data.wireless_2g_disabled, data.wireless_2g_encryption, $('div#map_router_24g_img'));
		scheduleModule.resetIcon(data, changeIcon, "2g");
		changeIcon(data.wireless_5g_enable, data.wireless_5g_disabled, data.wireless_5g_encryption, $('div#map_router_5g_img'));
		scheduleModule.resetIcon(data, changeIcon, "5g");

		tribandModule.statusRead(data, numberTest, changeIcon);
		if(data.wan_ipv4_snd_conn && data.wan_ipv4_snd_conn!=''){
			$('input#internet_snd_conn').textbox('show');
			$('input#internet_snd_ip').textbox('show');
			// $('input#internet_snd_conn').textbox('setValue', data.wan_ipv4_snd_conn);
			if(data.wan_ipv4_snd_conn=='dynamic'){
				$('input#internet_snd_conn').textbox('setValue', $.su.CHAR.BASIC_NETWORK.DYNAMIC_IP);
			}else if(data.wan_ipv4_snd_conn=='static'){
				$('input#internet_snd_conn').textbox('setValue', $.su.CHAR.BASIC_NETWORK.STATIC_IP);
			}
			$('input#internet_snd_ip').textbox('setValue', data.wan_ipv4_snd_ipaddr);
		}else{
			$('input#internet_snd_conn').textbox('hide');
			$('input#internet_snd_ip').textbox('hide');
		}
		
		// var wirelessCount = 0;
		// if( data.access_devices_wireless_host && data.access_devices_wireless_host.length >0){
		// 	$("div#map_grid_wireless_host").grid('getStore').loadData(data.access_devices_wireless_host);
		// 	wirelessCount += data.access_devices_wireless_host.length;
		// }else{
		// 	$("div#map_grid_wireless_host").grid('getStore').loadData([]);
		// }

		// if( data.access_devices_wireless_guest && data.access_devices_wireless_guest.length >0){
		// 	$("div#map_grid_wireless_guest").grid('getStore').loadData(data.access_devices_wireless_guest);
		// 	wirelessCount += data.access_devices_wireless_guest.length;
		// }else{
		// 	$("div#map_grid_wireless_guest").grid('getStore').loadData([]);		
		// }	
		// $('span#map_num_wireless').show();
		// $('span#map_num_wireless').html(wirelessCount);


		// if( data.access_devices_wired && data.access_devices_wired.length >0){
		// 	$("div#map_grid_wire").grid('getStore').loadData(data.access_devices_wired);
		// 	$('span#map_num_wire').show();
		// 	$('span#map_num_wire').html(data.access_devices_wired.length);
		// }else{
		// 	$("div#map_grid_wire").grid('getStore').loadData([]);
		// 	$('span#map_num_wire').show();
		// 	$('span#map_num_wire').html(0);
		// }

		if(data.storage_capacity==0 && data.storage_available==0){
			$('div#map_icon_usb').addClass('map-icon-usb-disconn');
		}
			if( data.storage_vendor.toUpperCase() == 'UNKNOWN' ){
				$('span#map_icon_usb_qs').show();
			}

		if(data.printer_count==0){
			$('div#map_icon_printer').addClass('map-icon-printer-disconn');
		}
			if(data.conn_type == '1'){
				conn_type = 1;
				$('div#network_modem_form').removeClass('hidden');
				$('div#network_internet_form').addClass('hidden');
				$('span#map_icon_internet_status').removeClass('map-icon-internet-disconn');
				$('span#map_icon_internet_status').removeClass('map-icon-internet-conn');
				$('span#map_icon_internet_status').removeClass('map-icon-internet-poor-conn');

				if(data.modem_status == '0' || data.modem_status == '3'){
					$('span#map_icon_internet_status').addClass('map-icon-internet-disconn');
				}else if(data.modem_status == '1' || data.modem_status == '2'){
					if(data.modem_connstatus == '1'){
						$('span#map_icon_internet_status').addClass('map-icon-internet-conn');
					}else{
						$('span#map_icon_internet_status').addClass('map-icon-internet-poor-conn');
					}
				}

				$('span#map_icon_internet_status').removeClass('hidden');
				switch(data.modem_status){
					case '0':
						//$('input#internet_modem_status').html($.su.CHAR.G3_G4.UNPLUGGED);
						$("input#internet_modem_status").textbox('setValue', $.su.CHAR.G3_G4.UNPLUGGED);
						break;
					case '1':
						//$('input#internet_modem_status').html($.su.CHAR.G3_G4.IDENTIFYING);
						$("input#internet_modem_status").textbox('setValue', $.su.CHAR.G3_G4.IDENTIFYING);
						break;
					case '2':
						//$('input#internet_modem_status').html($.su.CHAR.G3_G4.IDENTIFY_SUCCESS);
						$("input#internet_modem_status").textbox('setValue', $.su.CHAR.G3_G4.IDENTIFY_SUCCESS);
						break;
					case '3':
						//$('input#internet_modem_status').html($.su.CHAR.G3_G4.UNKNOWN_MODE);
						$("input#internet_modem_status").textbox('setValue', $.su.CHAR.G3_G4.UNKNOWN_MODE);
						break;
				}

			}else{
				conn_type = 0;
			}
			$("#basic_network_form").find(".grid-content-td-macaddr div").each(function(i,ele){
				if($(ele).text()==cacheMac){
					$(ele).addClass("focus");
					cacheEle = $(ele).parent();
				}
			})
	});
	}
	
	var statusInetProxy = new $.su.Proxy({
		url: $.su.url('/admin/status?form=internet')
	});

	function statusInetRead()
	{
		/*show modem*/
		if(conn_type == 1){ 
			$('div#network_internet_form').addClass('hidden');
			return;
		}else{
			$('div#network_internet_form').removeClass('hidden');
			$('div#network_modem_form').addClass('hidden');
	statusInetProxy.read({}, function(data, status, xhr){
		if( data.internet_status.toUpperCase() == 'CONNECTED' ){
			$('span#map_icon_internet_status').removeClass('map-icon-internet-poor-conn');
			$('span#map_icon_internet_status').removeClass('map-icon-internet-disconn');
			$('span#map_icon_internet_status').addClass('map-icon-internet-conn');
			$("input#internet_status").textbox('setValue', $.su.CHAR.BASIC_NETWORK.CONNECTED);
		}else if(  data.internet_status.toUpperCase() == 'UNPLUGGED' ){
			$('span#map_icon_internet_status').removeClass('map-icon-internet-conn');
			$('span#map_icon_internet_status').removeClass('map-icon-internet-poor-conn');
			$('span#map_icon_internet_status').addClass('map-icon-internet-disconn');
			$("input#internet_status").textbox('setValue', $.su.CHAR.BASIC_NETWORK.UNPLUGGED);
		}else if(  data.internet_status.toUpperCase()=='POOR_CONNECTED' ){
			$('span#map_icon_internet_status').removeClass('map-icon-internet-conn');
			$('span#map_icon_internet_status').removeClass('map-icon-internet-disconn');
			$('span#map_icon_internet_status').addClass('map-icon-internet-poor-conn');
			$("input#internet_status").textbox('setValue', $.su.CHAR.BASIC_NETWORK.POOR_CONNECTED);
			//console.log( data.internet_status.slice(0, 1)	)
		}else if( data.internet_status.toUpperCase() == 'DISCONNECTED' ){
			$('span#map_icon_internet_status').removeClass('map-icon-internet-conn');
			$('span#map_icon_internet_status').removeClass('map-icon-internet-disconn');
			$('span#map_icon_internet_status').addClass('map-icon-internet-poor-conn');
			$("input#internet_status").textbox('setValue', $.su.CHAR.BASIC_NETWORK.DISCONNECTED);
		}else if( data.internet_status.toUpperCase() == 'CONNECTING' ){
			$('span#map_icon_internet_status').removeClass('map-icon-internet-conn');
			$('span#map_icon_internet_status').removeClass('map-icon-internet-disconn');
			$('span#map_icon_internet_status').addClass('map-icon-internet-poor-conn');
			$("input#internet_status").textbox('setValue', $.su.CHAR.BASIC_NETWORK.CONNECTING);
		}
		$('span#map_icon_internet_status').removeClass('hidden');
		//$("input#internet_status").textbox('setValue', (data.internet_status.slice(0, 1).toUpperCase()+data.internet_status.slice(1)).replace('_', ' ') );
	});
		}
		
	}

	var statusInetRefreshId = null;

	statusInetRead();
	if (!statusInetRefreshId)
	{
		statusInetRefreshId = setInterval(statusInetRead, 10*1000);
	}


/////////////////

	$("input#internet_status").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.INTERNET_STATUS,
	//	labelCls:"xxs",
		cls:sysMode=="ap"?"hidden":"",
		readOnly: true
	});

	$("input#internet_mac").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.MAC_ADDR,
	//	labelCls:"xxs",
		cls:sysMode=="ap"?"":"hidden",
		readOnly: true
	});

	$("input#internet_conn_type").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.CONNECTION_TYPE,
	//	labelCls:"xxs",
		cls:sysMode=="ap"?"hidden":"",
		readOnly: true
	});


	$("input#internet_ip_address").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.INTERNET_IP_ADDR,
	//	labelCls:"xxs",
		readOnly: true
	});

	$("input#internet_mask").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.SUBNET_MASK,
	//	labelCls:"xxs",
		cls:sysMode=="ap"?"":"hidden",
		readOnly: true
	});

	$("input#ap_internet_conn_type").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.CONNECTION_TYPE,
	//	labelCls:"xxs",
		cls:sysMode=="ap"?"":"hidden",
		readOnly: true
	});

	$("input#internet_snd_conn").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.SECONDARY_CONN,
	//	labelCls:"xxs",
		cls: 'hidden',
		readOnly: true
	});

	$("input#internet_snd_ip").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.IP_ADDR,
	//	labelCls:"xxs",
		cls: 'hidden',
		readOnly: true
	});

//////////////// modem
	$("input#internet_modem_status").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.MODEM_STATUS,
	//	labelCls:"xxs",
		readOnly: true
	});

	$("input#internet_modem_ip").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.IP_ADDR,
	//	labelCls:"xxs",
		readOnly: true
	});

	$("input#internet_modem_signal").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.MODEM_SIGNAL,
	//	labelCls:"xxs",
		readOnly: true
	});


	$("input#printer_name").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.NAME,
		labelCls:"xxs",
		readOnly: true
	});

	$("input#network_mac").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.MAC_ADDR,
	//	labelCls:"xxs",
		readOnly: true
	});
	$("input#network_ip").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.INTERNET_IP_ADDR,
	//	labelCls:"xxs",
		readOnly: true
	});
	$("input#network_mask").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.SUBNET_MASK,
	//	labelCls:"xxs",
		readOnly: true
	});
	$("input#network_type").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.CONNECTION_TYPE,
	//	labelCls:"xxs",
		readOnly: true
	});
	if(sysMode=="ap")
		networkProxy.read({},function(data){
			$("input#network_mac").textbox("setValue",data.macaddr);
			$("input#network_ip").textbox("setValue",data.ipaddr);
			$("input#network_mask").textbox("setValue",data.mask_type);	
			$("input#network_type").textbox("setValue",data.lan_type=="static"?$.su.CHAR.LAN.STATIC:$.su.CHAR.LAN.DHCP);	
			$("#network_internet_form").hide();
			$("#ap_network_form").show();
		});
/////////////////

	$("input#usb_storage_brand").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.USB_DISK,
		labelCls: 'xxs',
	//	cls: 'inlineBlock',
	//	inputCls: 'usb-storage-input usb-input-blue',
		readOnly: true
	});


	$("input#usb_storage_total").textbox({
		fieldLabel: null,
		cls: 'inlineBlock',
		inputCls: 'usb-storage-input usb-input-blue',
		readOnly: true
	});

	$("input#usb_storage_total_unit").textbox({
		fieldLabel: null,
		cls: 'inlineBlock',
		inputCls: 'usb-storage-input',
		readOnly: true
	});

	$("input#usb_storage_available").textbox({
		fieldLabel: null,
		cls: 'inlineBlock',
		inputCls: 'usb-storage-input usb-input-blue',
		readOnly: true
	});

	$("input#usb_storage_available_unit").textbox({
		fieldLabel: null,
		cls: 'inlineBlock',
		inputCls: 'usb-storage-input',
		readOnly: true
	});
///////////////////  router  form


	// $("input#router_wireless_24g_ssid").textbox({
	// 	fieldLabel: $.su.CHAR.BASIC_NETWORK.SSID,
	// 	labelCls:"xxs",
	// 	readOnly: true
	// });

    $("#wireless_2g_ssid_label").html($.su.CHAR.BASIC_NETWORK.SSID+":");

	$("input#router_wireless_24g_channel").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.CHANNEL,
		labelCls:"xxs",
		readOnly: true
	});

	$("input#router_wireless_24g_mac").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.MAC,
		labelCls:"xxs",
		readOnly: true
	});

	// $("input#router_wireless_5g_ssid").textbox({
	// 	fieldLabel: $.su.CHAR.BASIC_NETWORK.SSID,
	// 	labelCls:"xxs",
	// 	readOnly: true
	// });

	$("#wireless_5g_ssid_label").html($.su.CHAR.BASIC_NETWORK.SSID+":");

	$("input#router_wireless_5g_channel").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.CHANNEL,
		labelCls:"xxs",
		readOnly: true
	});

	$("input#router_wireless_5g_mac").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.MAC,
		labelCls:"xxs",
		readOnly: true
	});


	$("input#router_guest_24g_status").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.STATUS,
		labelCls:"xxs",
		readOnly: true
	});


	// $("input#router_guest_24g_ssid").textbox({
	// 	fieldLabel: $.su.CHAR.BASIC_NETWORK.SSID,
	// 	labelCls:"xxs",
	// 	readOnly: true
	// });

	$("#guest_2g_ssid_label").html($.su.CHAR.BASIC_NETWORK.SSID+":");

	$("input#router_guest_5g_status").textbox({
		fieldLabel: $.su.CHAR.BASIC_NETWORK.STATUS,
		labelCls:"xxs",
		readOnly: true
	});


	// $("input#router_guest_5g_ssid").textbox({
	// 	fieldLabel: $.su.CHAR.BASIC_NETWORK.SSID,
	// 	labelCls:"xxs",
	// 	readOnly: true
	// });

	$("#guest_5g_ssid_label").html($.su.CHAR.BASIC_NETWORK.SSID+":");

////////////  grid


///////////////////////////// widget operation
	$('div#map_internet').click(function(){
		clearStatus();
		$('div#map_icon_internet').addClass('selected');
		$('div.panel').hide();
		$("#cmoc-tips").hide();
		$('div#internet_panel').fadeIn(150);
	});

	$('div#map_router').click(function(){
		clearStatus();
		$('div#map_icon_router').addClass('map-icon-router-conn');
		$('div.panel').hide();
		$("#cmoc-tips").hide();
		$('div#router_panel').fadeIn(150);
		lanScan();
	});

	$('div#map_wireless').click(function(){
		clearStatus();
		$('div#map_icon_wireless').addClass('map-icon-wireless-conn');
		$('div.panel').hide();
		$("#cmoc-tips").hide();
		$('div#wireless_host_panel').fadeIn(150);
		if($(".wireless-host").hasClass("selected")){
			$('#map_grid_wireless_host').parent().show();
		}else{
		$('div#wireless_guest_panel').fadeIn(150);
		}
	});

	$('.wireless-device').click(function(){
		$('div#wireless_guest_panel').hide();
		$('#map_grid_wireless_host').parent().hide();
		$('.wireless-device').removeClass("selected");
		$(this).addClass("selected");
		if($(this).attr("class").indexOf("host")>-1){
			$('#map_grid_wireless_host').parent().show();
		}else{
			$('div#wireless_guest_panel').fadeIn(150);
		}
		
	})
	
	$('div#map_wire').click(function(){
		clearStatus();
		$('div#map_icon_wire').addClass('map-icon-wire-conn');
		$('div.panel').hide();
		$("#cmoc-tips").hide();
		$('div#wire_panel').fadeIn(150);
	});

	$('div#map_printer').click(function(){
		clearStatus();
		$('div#map_icon_printer').addClass('map-icon-printer-conn');
		$('div.panel').hide();
		$("#cmoc-tips").hide();
		$('div#printer_panel').fadeIn(150);
	});

	$('div#map_usb').click(function(){
		clearStatus();
		$('div#map_icon_usb').addClass('map-icon-usb-conn');
		$('div.panel').hide();
		$("#cmoc-tips").hide();
		$('div#usb_panel').fadeIn(150);
	});

	$("#lan_traffic_grid").grid({
		store:{
			fields: [
				{name: "status"},
				{name: "speed"},
				{name: "duplex"}
			],
			autoLoad: false
		},
		minLines: 0,
		maxLines: 5,
		columns: [
			{
				text: $.su.CHAR.BASIC_NETWORK.PORT,
				width:160,
				renderer:function(value, index, data){
					if(index == 0)
						return $.su.CHAR.BASIC_NETWORK.INTERNET;
					return $.su.CHAR.BASIC_NETWORK.LAN + (index) ;
				}
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.LAN_STATUS, 
				dataIndex: "status",
				width: 160,
				renderer:function(value, index, data){
					if(index == 0){
						return  $.su.CHAR.BASIC_NETWORK[value.toUpperCase()];
					}
					return  $.su.CHAR.BASIC_NETWORK["LAN_"+value.toUpperCase()];
				}
			},
			{
				text: $.su.CHAR.BASIC_NETWORK.LAN_SPEED,
				dataIndex: "speed",
				renderer:function(value, index, data){
					if(value>0){
						return $.su.CHAR.INTERNET[data.duplex.toUpperCase()+"_DUPLEX_"+value];
					}else{
						return "---";
					}
				}
			}
		]

	});

	var lanProxy = new $.su.Proxy({
		url: $.su.url("/admin/status?form=router")
	});
	var lanInterval;
	function lanScan(){
		lanProxy.read({},function(datas){
			var result=[];
			var tmpData={};
			for(var i=0, j;i<datas.length;i++){
				for(j in datas[i]){
					if(/status/.test(j))
						tmpData.status=datas[i][j];
					else if(/speed/.test(j))
						tmpData.speed=datas[i][j];
					else
						tmpData.duplex=datas[i][j];
				}
				result[i]={
					"status":tmpData.status,
					"speed":tmpData.speed || "-1",
					"duplex":tmpData.duplex || "-1"
				};
				tmpData={};
			}
			$("#lan_traffic_grid").grid("getStore").loadData(result);
			//lanInterval = setTimeout(lanScan,1000);
		});
	}
	lanScan();

	if(window.sysMode === 'router' && $.su.module.support_one_mesh) {
		// init one mesh in router mode
		$("#map-container").addClass("router-mode");
		$('p#map_mesh_p').html($.su.CHAR.BASIC_NETWORK.MESH_DEVICES);
		$('span#map_title_mesh').html($.su.CHAR.BASIC_NETWORK.MESH_DEVICES);
		$("#no-mesh-device-note-1").html($.su.CHAR.ONE_MESH.NO_MESH_DEVICE_NOTE_1);
		$("#no-mesh-device-note-2").html($.su.CHAR.ONE_MESH.NO_MESH_DEVICE_NOTE_2);
		var meshListProxy = new $.su.Proxy({
			url: $.su.url("/admin/onemesh_network?form=mesh_sclient_list_all")
		});
		var meshDetailProxy = new $.su.Proxy({
			url: $.su.url("/admin/onemesh_network?form=mesh_sclient_detail")
		});
		var meshListStore = new $.su.Store({
			proxy: meshListProxy,
			fields: [
				{name: "name"},
				{name: "model"},
				{name: "status"},
				{name: "location"},
				{name: "mac"}
			],
			autoLoad: false
		});
		meshListStore.load({operation: "read"});
		$("input#mesh-device-name").textbox({
			fieldLabel: $.su.CHAR.ONE_MESH.NAME,
			labelCls: "xs",
			inputCls: "xl",
			allowBlank: false,
			maxLength: 64
		});
		$("input#mesh-device-mac").textbox({
			fieldLabel: null,
			cls: "hidden"
		});
		$("#mesh-device-location").combobox({
			fieldLabel: $.su.CHAR.ONE_MESH.LOCATION,
			cls: "mesh-device-location",
			labelCls: "xs",
			inputCls: "xl",
			items: [
				{ value: "bedroom", name: $.su.CHAR.ONE_MESH.BEDROOM },
				{ value: "hallway", name: $.su.CHAR.ONE_MESH.HALLWAY },
				{ value: "kitchen", name: $.su.CHAR.ONE_MESH.KITCHEN },
				{ value: "living_room", name: $.su.CHAR.ONE_MESH.LIVING_ROOM },
				{ value: "master_bedroom", name: $.su.CHAR.ONE_MESH.MASTER_ROOM },
				{ value: "office", name: $.su.CHAR.ONE_MESH.OFFICE },
				{ value: "study", name: $.su.CHAR.ONE_MESH.STUDY },
				{ value: "other", name: $.su.CHAR.ONE_MESH.OTHER }
			]
		});
		var meshGrid = $("div#map_grid_mesh").grid({
			store: meshListStore,
			editor: {
				// content: "default",
				content: "#map_grid_mesh_editor",
				fields: [
					{name: "name"},
					{name: "location"},
					{name: "mac"}
				],
				validator: function() {
					var editor = $(meshGrid.grid("getEditor"))
					var meshEditorForm = editor.children("td.editor-container");
					var key = editor.prev("tr").data("key");
					var meshValidate = function() {
						if($("input#mesh-device-name").textbox("getValue").length === 0) {
							return false;
						}
						return true;
					};
					if(meshValidate()) {
						var newData = meshEditorForm.form("serialize");
						meshDetailProxy.write(newData, function(data) {
							meshGrid.grid("prompt", true);
							// 手动modify和load data，防止表格刷新导致editor消失
							var data = meshGrid.grid("getStore").data;
							$.each(data, function(i, v) {
								if(key === v.key) {
									$.extend(v, newData);
									return;
								}
							});
							$(meshGrid.grid("getEditor")).editor("cancelEdit");
							meshGrid.grid("getStore").loadData(data);
						}, function() {
							meshGrid.grid("prompt", false);
						}, function() {
							meshGrid.grid("prompt", false);
						});
					}
					return false;
				}
			},
			columns: [
				{
					text: $.su.CHAR.GRID_ID_COLUMN,
					xtype: "rownumberer",
					width: 40
				},
				{
					text: $.su.CHAR.BASIC_NETWORK.NAME,
					dataIndex: "name",
					width: 114
				},
				{
					text: $.su.CHAR.BASIC_NETWORK.MODEL,
					width: 114,
					dataIndex: "model"
				},
				{
					text: $.su.CHAR.BASIC_NETWORK.STATUS,
					width: 136,
					dataIndex: "status",
					renderer: function(val, index, data) {
						switch(val) {
							case "connected":
								return $.su.CHAR.BASIC_NETWORK.CONNECTED;
							case "disconnected":
								return $.su.CHAR.BASIC_NETWORK.DISCONNECTED;
							default:
								return val;
						}
					}
				},
				{
					text: $.su.CHAR.BASIC_NETWORK.LOCATION,
					width: 136,
					dataIndex: "location",
					renderer: function(val, index, data) {
						switch(val) {
							case "bedroom":
								return $.su.CHAR.ONE_MESH.BEDROOM;
							case "hallway":
								return $.su.CHAR.ONE_MESH.HALLWAY;
							case "kitchen":
								return $.su.CHAR.ONE_MESH.KITCHEN;
							case "living_room":
								return $.su.CHAR.ONE_MESH.LIVING_ROOM;
							case "master_bedroom":
								return $.su.CHAR.ONE_MESH.MASTER_ROOM;
							case "office":
								return $.su.CHAR.ONE_MESH.OFFICE;
							case "study":
								return $.su.CHAR.ONE_MESH.STUDY;
							case "other":
								return $.su.CHAR.ONE_MESH.OTHER;
							default:
								return val;
						}
					}
				},
				{
					text: $.su.CHAR.GRID.MODIFY,
					renderer:function(data,i,rawData){
						var inHTML= "";
						inHTML += 		"<a href=\"javascript:void(0);\" data-index=\""+i+"\" data-key=\"key-"+i+"\" data-mac=\""+rawData.mac+"\" class=\"grid-content-btn grid-content-btn-edit btn-edit\">";
						inHTML +=			"<span class=\"icon\"></span>";
						inHTML += 			"<span class=\"text\">"+$.su.CHAR.OPERATION.EDIT+"</span>";
						inHTML += 		"</a>";
						return inHTML;
					}
				}
			]
		}).on("ev_load", function(e, data) {
				if(data && data.length > 0) {
					$("#map_grid_mesh").show();
					$("#map_mesh_no_devices").hide();
					$("span#map_num_mesh").html(data.length);
				} else {
					$("#map_grid_mesh").hide();
					$("#map_mesh_no_devices").show();
					$("span#map_num_mesh").html(0);
				}
		});
		$('div#map_mesh').click(function(){
			clearStatus();
			$('div#map_icon_mesh').addClass('map-icon-mesh-conn');
			$('div.panel').hide();
			$('div#mesh_panel').fadeIn(150);
		});
	} else {
		$("#map-container").removeClass("router-mode");
		$("#map_mesh").addClass("hidden");
	}
	
	var ouiProxy = new $.su.Proxy({
		url: $.su.url("/admin/status?form=oui")
	});
	
	$(".CMOC_title:eq(0)").text($.su.CHAR.BASIC_NETWORK.MAC_OUI+":");
	$(".CMOC_title:eq(1)").text($.su.CHAR.BASIC_NETWORK.MAC_ADDR+":");
	$(".CMOC_title:eq(2)").text($.su.CHAR.BASIC_NETWORK.SIGNAL+":");
	$(".CMOC_title:eq(3)").text($.su.CHAR.BASIC_NETWORK.TXR+":");
	$(".CMOC_title:eq(4)").text($.su.CHAR.BASIC_NETWORK.RXR+":");
	$(".CMOC_title:eq(5)").text($.su.CHAR.BASIC_NETWORK.ACCTIME+":");
	$("#CMOC_loading").status({
		cls: "inline-block"
	}).status("setLoading");
	$("#cmoc-tips").hide();
	
	var cacheMac;
	var cacheEle;
	var timeInterval;
	$("#basic_network_form").on("mouseenter",".grid-content-td-macaddr",function(){
		var type = $(this).parents(".grid-panel").attr("id").indexOf("wireless")>-1?"wireless":"wired";
		if(cacheMac == $(arguments[0].target).find("div").text() || !$(arguments[0].target).hasClass("grid-content-td")) return;
		clearInterval(timeInterval);
		$("#basic_network_form").find(".grid-content-td div").removeClass("focus");
		cacheMac = $(arguments[0].target).find("div").text();
		$("#CMOC_loading").status("show");
		$("#CMOC").hide();
		var mac = $(arguments[0].target).find("div").text();
		var ele = arguments[0].target;
		$(ele).find("div").addClass("focus");
		cacheEle = $(ele);
		var offsetTop = $(ele).offset().top;
		
		ouiProxy.read({mac:mac,type:type},function(data){
			if (cacheMac == "") return;
			if ((data.macaddr != undefined) && (cacheMac != data.macaddr)) return;
			$("#CMOC_loading").status("hide");
			$("#CMOC").show();
			
			// if this client is connected to onemesh RE, the oui info is emtpy; only show mac here;
			if (data.macaddr == undefined)
			{
				$(".CMOC_content:eq(0)").text("");
				$(".CMOC_content:eq(1)").text(cacheMac);
				$(".CMOC_content:eq(2)").text("");
				$(".CMOC_content:eq(3)").text("");
				$(".CMOC_content:eq(4)").text("");
				$(".CMOC_content:eq(5)").text("");
			}else{
				$(".CMOC_content:eq(0)").text(data.oui.length>35?(data.oui.slice(0,32)+"..."):data.oui);
				$(".CMOC_content:eq(1)").text(data.macaddr);			
				$(".CMOC_content:eq(2)").text(data.signal);
				if(data.tx_rate!=undefined && data.rx_rate!=undefined){
					$(".CMOC_content:eq(3)").text($.su.func.changeUnit(data.tx_rate*1000,1)+"bps");
					$(".CMOC_content:eq(4)").text($.su.func.changeUnit(data.rx_rate*1000,1)+"bps");
					$(".CMOC_content:eq(5)").text(tansDate(data.access_time));
				}
			}
			if(type=="wired"){
				$("#CMOC ul li:eq(2)").hide();
				$("#CMOC ul li:eq(3)").hide();
				$("#CMOC ul li:eq(4)").hide();
				$("#CMOC ul li:eq(5)").hide();
			}else{
				$("#CMOC ul li:eq(2)").show();
				$("#CMOC ul li:eq(3)").show();
				$("#CMOC ul li:eq(4)").show();
				$("#CMOC ul li:eq(5)").show();					
			}
			$("#cmoc-tips").css({
				"top": offsetTop - $("#basic_network_form").offset().top + 30,
				"display": "block"
			});
		        
		    // if this client is connected to onemesh RE, the oui info is emtpy; only show mac here;    	
			if (data.macaddr == undefined){
				$("#CMOC ul li:eq(5)").hide();
			}
			else{
				var tmpTime = data.access_time || 1;
				clearInterval(timeInterval);
				timeInterval = setInterval(function(){
					tmpTime++;
					$(".CMOC_content:eq(5)").text(tansDate(tmpTime));
				},1000);
			}			
		},function(){ // when OUI info returns fail
		  $("#cmoc-tips").hide();
		  clearInterval(timeInterval);
		},function(){ // when web can't get OUI info
		  $("#cmoc-tips").hide();
		  clearInterval(timeInterval);
		});
		$("#cmoc-tips").css({
			"top": $(arguments[0].target).offset().top - $("#basic_network_form").offset().top + 30,
			"display": "block"
		});
	});
	
	$("#basic_network_form").on("mouseleave",".grid-content-td-macaddr",function(){
		//if($(arguments[0].target).parent().hasClass("grid-content-td") || $(arguments[0].target).hasClass("grid-content-td") ) return;
			if(cacheEle) cacheEle.find("div").removeClass("focus")
			cacheMac = "";
			cacheEle = "";
			$("#cmoc-tips").hide();
			$(this).find(".grid-content-td div").removeClass("focus");
			clearInterval(timeInterval);
	});
	function tansDate(seconds){
		var second = Math.floor(seconds%60),
			minute = Math.floor(seconds/60%60),
			hour = Math.floor(seconds/60/60%24);
			day = Math.floor(seconds/60/60/24)>0?(Math.floor(seconds/60/60/24)+$.su.CHAR.BASIC_NETWORK.DAY+" "):"";
		second = second>10?second:("0"+second);
		minute = minute>10?minute:("0"+minute);
		hour = hour>10?hour:("0"+hour);
		return day+hour+":"+minute+":"+second;
	}

	var content= [];
	if(window.sysMode!="ap"){
		content = ["BASIC_NETWORK","BASIC_NETWORK_INTEREST","BASIC_SPEED_TEST","BASIC_NETWORK_ROUTER", "BASIC_NETWORK_ONEMESH","BASIC_NETWORK_CLIENTS","BASIC_NETWORK_PRINTER"];
	}
	else {
		content = ["BASIC_NETWORK","BASIC_NETWORK_INTEREST","BASIC_NETWORK_ROUTER", "BASIC_NETWORK_ONEMESH","BASIC_NETWORK_CLIENTS","BASIC_NETWORK_PRINTER"];
	}
	content = usbModule.addHelpContent(content);
	var helpBasicNetwork = new $.su.Help({
		container: "div#basic_network_help",
		content: content,
		afterLoad: function(){
			if(sysMode=="ap"){
				$(".title:eq(1)").text($.su.CHAR.MENU.NETWORK);
				$(".title:eq(1)+.main-container p").text($(".title:eq(1)+.main-container p").text().replace($.su.CHAR.BASIC_NETWORK.INTERNET,$.su.CHAR.MENU.NETWORK));
			}
			tribandModule.helpInit();
		}
	});

	$.su.app.runningModule.addUnloadHandler(function(){
		clearInterval(statusRefreshId);
		clearInterval(statusInetRefreshId);
		clearTimeout(lanInterval);
		clearInterval(timeInterval);
		clearInterval(getClientsDataRefreshId);
		$(".grid-content-td-macaddr").unbind();
	});

});
//]]>
</script>

</body>
</html>
